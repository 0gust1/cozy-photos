{"version":3,"file":"public/javascripts/app.js","sources":["app/application.coffee","app/collections/album.coffee","app/collections/photo.coffee","app/initialize.coffee","app/lib/base_view.coffee","app/lib/client.coffee","app/lib/clipboard.coffee","app/lib/helpers.coffee","app/lib/modal.coffee","app/lib/view_collection.coffee","app/locales/en.coffee","app/locales/fr.coffee","app/models/album.coffee","app/models/photo.coffee","app/models/photoprocessor.coffee","app/models/thumbprocessor.coffee","app/router.coffee","app/templates/album.jade","app/templates/albumlist.jade","app/templates/albumlist_item.jade","app/templates/browser.jade","app/templates/galery.jade","app/templates/photo.jade","app/views/album.coffee","app/views/albumslist.coffee","app/views/albumslist_item.coffee","app/views/browser.coffee","app/views/galery.coffee","app/views/photo.coffee"],"names":[],"mappings":"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AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxBA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3GA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;;ACAA;EAAA;;oFAAA;;AAAA,MAAM,QAAQ,aAAR,CAAN;;AAAA,QAEA,GAAW,QAAQ,eAAR,CAFX;;AAAA,MAGA,GAAS,QAAQ,cAAR,CAHT;;AAAA,SAIA,GAAY,QAAQ,eAAR,CAJZ;;AAAA,WAMA,GAAc,QAAQ,uBAAR,CANd;;AAAA,kBAOA,GAAqB,QAAQ,iCAAR,CAPrB;;AAAA,SAQA,GAAgB,eARhB;;AAAA,YAUA,GAAe,CAVf;;AAAA;AAaI;;;;GAAA;;AAAA,oCAAY;AACR;WACA,IAAC,QAAD,GAFQ;EAAA,CAAZ;;AAAA,uBAMA,UAAS,SAAC,GAAD;WAAS,IAAC,MAAK,CAAC,YAAP,CAAoB,GAApB,EAAT;EAAA,CANT;;oBAAA;;GADqB,mBAZzB;;AAAA,MAqBM,CAAC,OAAP,GAAuB;AACnB;;;;;;;;;;;;GAAA;;AAAA,iCAAU,QAAQ,iBAAR,CAAV;;AAAA,sBAEA,KAAI,OAFJ;;AAAA,sBAGA,YAAW,iBAHX;;AAAA,sBAKA,SAAQ;WACJ;AAAA,wBAAkB,IAAC,aAAnB;AAAA,MACA,qBAAqB,IAAC,gBADtB;AAAA,MAEA,oBAAoB,IAAC,SAFrB;AAAA,MAGA,0BAA0B,IAAC,cAH3B;AAAA,MAIA,eAAe,IAAC,eAJhB;AAAA,MAKA,qBAAqB,IAAC,qBALtB;AAAA,MAMA,gBAAgB,IAAC,eANjB;AAAA,MAOA,sBAAsB,IAAC,eAPvB;AAAA,MAQA,oBAAoB,IAAC,eARrB;AAAA,MASA,0BAA0B,IAAC,eAT3B;AAAA,MAUA,kBAAkB,IAAC,eAVnB;AAAA,MAWA,wBAAwB,IAAC,eAXzB;AAAA,MAYA,wBAAwB,IAAC,mBAZzB;MADI;EAAA,CALR;;AAAA,sBAqBA,aAAY,SAAC,OAAD;AACR,8CAAM,OAAN;WAEA,IAAC,SAAD,CAAU,IAAC,MAAK,CAAC,MAAjB,EAAyB,YAAzB,EAAuC,IAAC,wBAAxC,EAHQ;EAAA,CArBZ;;AAAA,sBA0BA,gBAAe;AACX;AAAA,UAAM,CAAC,CAAC,GAAF,EAAO,CAAC,KAAR,CAAc,KAAd,CAAN;AAAA,IACA,eAAgB,YAAQ,KAAC,MAAK,CAAC,GAAP,CAAW,IAAX,EAAR,GAAyB,MADzC;AAEA,QAAiC,WAAjC;AAAA,sBAAiB,UAAM,GAAvB;KAFA;AAAA,IAIA,MAAM,CAAC,CAAC,MAAF,CACF;AAAA,oBAAc,YAAd;AAAA,MACA,cAAc,IAAC,MAAK,CAAC,MAAM,CAAC,MAD5B;KADE,EAGJ,IAAC,MAAK,CAAC,UAHH,CAJN;WAQA,IATW;EAAA,CA1Bf;;AAAA,sBAqCA,cAAa;AACT,QAAC,OAAD,GAAc,WACV;AAAA,UAAI,IAAC,EAAD,CAAG,SAAH,CAAJ;AAAA,MACA,UAAU,IAAC,QAAO,CAAC,QADnB;AAAA,MAEA,YAAY,IAAC,MAAK,CAAC,MAFnB;AAAA,MAGA,cAAc,IAAC,kBAHf;KADU,CAAd;AAAA,IAMA,IAAC,MAAD,GAAS,IAAC,EAAD,CAAG,QAAH,CANT;AAAA,IAOA,IAAC,YAAD,GAAe,IAAC,EAAD,CAAG,cAAH,CAPf;AAAA,IASA,IAAC,OAAM,CAAC,KAAR,GAAgB,IAAC,MATjB;AAAA,IAUA,IAAC,OAAM,CAAC,MAAR,EAVA;AAYA,QAAG,IAAC,QAAO,CAAC,QAAZ;aACI,IAAC,aAAD,GADJ;KAAA;AAGI,UAAC,MAAK,CAAC,QAAP,CAAgB,UAAhB;aACA,IAAC,YAAW,CAAC,QAAb,CAAsB,UAAtB,EAJJ;KAbS;EAAA,CArCb;;AAAA,sBAwDA,oBAAmB,SAAC,QAAD;WACf,SAAS;AAAA,eAAS,IAAC,MAAK,CAAC,EAAhB;KAAT,EADe;EAAA,CAxDnB;;AAAA,sBA2DA,iBAAgB;WACZ,IAAC,UAAD,CAAW;AAAA,aAAO,IAAC,MAAK,CAAC,GAAP,EAAY,CAAC,IAAb,EAAP;KAAX,EADY;EAAA,CA3DhB;;AAAA,sBA8DA,uBAAsB;WAClB,IAAC,UAAD,CAAW;AAAA,mBAAa,IAAC,YAAW,CAAC,GAAb,EAAkB,CAAC,IAAnB,EAAb;KAAX,EADkB;EAAA,CA9DtB;;AAAA,sBAiEA,eAAc;AACV,QAAC,IAAG,CAAC,QAAL,CAAc,SAAd;AAAA,IACA,IAAC,QAAO,CAAC,QAAT,GAAoB,IADpB;WAEA,IAAC,OAAM,CAAC,OAAO,CAAC,QAAhB,GAA2B,KAHjB;EAAA,CAjEd;;AAAA,sBAsEA,kBAAiB;AACb,QAAC,IAAG,CAAC,WAAL,CAAiB,SAAjB;AAAA,IACA,IAAC,QAAO,CAAC,QAAT,GAAoB,KADpB;WAEA,IAAC,OAAM,CAAC,OAAO,CAAC,QAAhB,GAA2B,MAHd;EAAA,CAtEjB;;AAAA,sBA2EA,iBAAgB,SAAC,KAAD;AACZ,aAAQ,QAAO,CAAC,QAAhB;AACI,WAAK,CAAC,cAAN;aACA,MAFJ;KADY;EAAA,CA3EhB;;AAAA,sBAiFA,eAAc;AACV,QAAG,QAAQ,EAAE,4CAAF,CAAR,CAAH;aACI,IAAC,MAAK,CAAC,OAAP,EAAgB,CAAC,IAAjB,CAAsB;eAClB,GAAG,CAAC,MAAM,CAAC,QAAX,CAAoB,QAApB,EAA8B,IAA9B,EADkB;MAAA,CAAtB,EADJ;KADU;EAAA,CAjFd;;AAAA,sBAuFA,kBAAiB,SAAC,KAAD;AACb,QAAkC,mCAAlC;AAAA,UAAC,MAAK,CAAC,GAAP,CAAW,WAAX,EAAwB,EAAxB;KAAA;AAAA,IACA,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,EAAmB,OAAnB,CADA;WAEI,eAAW;AAAA,aAAO,IAAC,MAAR;KAAX,EAHS;EAAA,CAvFjB;;AAAA,sBA+FA,gBAAe,SAAC,KAAD;AACX;AAAA,MAAE,eAAF,CAAkB,CAAC,MAAnB;AAAA,IACA,SAAS,IAAC,MAAK,CAAC,MAAM,CAAC,MADvB;AAAA,IAGA,UAAU;AACN;AAAA,UAAG,MAAM,CAAC,MAAP,GAAgB,EAAnB;AACI,gBAAQ,MAAM,CAAC,GAAP,EAAR;eACA,WAAW;AACP,qBAAW,CAAC,OAAZ,CAAoB,KAApB;iBACA,UAFO;QAAA,CAAX,EAGE,GAHF,EAFJ;OADM;IAAA,CAHV;WAUA,UAXW;EAAA,CA/Ff;;AAAA,sBA4GA,qBAAoB,SAAC,KAAD;AAChB,QAAG,iBAAiB,KAAK,CAAC,OAAvB,qBAAgC,KAAK,CAAC,KAAzC;aACI,EAAE,cAAF,CAAiB,CAAC,KAAlB,GADJ;KADgB;EAAA,CA5GpB;;AAAA,sBAgHA,YAAW,SAAC,IAAD;WACP,IAAC,MAAK,CAAC,IAAP,CAAY,IAAZ,EADO;EAAA,CAhHX;;AAAA,sBAmHA,0BAAyB;WAErB,IAAC,EAAD,CAAG,eAAH,CAAmB,CAAC,IAApB,CAAyB,IAAC,MAAK,CAAC,MAAM,CAAC,MAAvC,EAFqB;EAAA,CAnHzB;;mBAAA;;GADqC,SArBzC;;;;ACAA;EAAA;;iSAAA;;AAAA,iBAAiB,QAAQ,qBAAR,CAAjB;;AAAA,GACA,GAAM,QAAQ,aAAR,CADN;;AAAA,MAOM,CAAC,OAAP,GAAuB;AACnB;;;;;GAAA;;AAAA,4BAAI,YAAJ;;AAAA,uBACA,WAAU,QAAQ,uBAAR,CADV;;AAAA,uBAEA,WAAU,QAAQ,qBAAR,CAFV;;AAAA,uBAIA,aAAY;WACR,uDADQ;EAAA,CAJZ;;AAAA,uBAOA,eAAc;WACV,IAAC,EAAD,CAAG,OAAH,CAAW,CAAC,MAAZ,CAAmB,CAAC,CAAC,IAAF,CAAO,IAAC,MAAR,MAAkB,CAAlB,IAAwB,GAAG,CAAC,IAAJ,KAAY,QAAvD,EADU;EAAA,CAPd;;AAAA,uBAUA,cAAa;WACT,wDADS;EAAA,CAVb;;oBAAA;;GADsC,eAP1C;;;;ACAA;EAAA;iSAAA;;AAAA,WAAW,QAAQ,eAAR,CAAX;;AAAA,cACgB,QAAQ,aAAR,EAAf,WADD;;AAAA,OAEA,GAAU,QAAQ,aAAR,CAFV;;AAAA,MAKM,CAAC,OAAP,GAAuB;AACnB;;;;GAAA;;AAAA,kCAAW,WAAX;;AAAA,sBACA,WAAU,QAAQ,0BAAR,CADV;;AAAA,sBAGA,aAAY;WACR,IAAC,SAAD,CAAU,IAAC,MAAX,EAAkB,QAAlB,EAA4B;aAAA;eAAG,KAAC,OAAD,GAAH;MAAA;IAAA,QAA5B,EADQ;EAAA,CAHZ;;AAAA,sBAMA,gBAAe;AACX;AAAA,UAAM,CAAC,CAAC,KAAF,CAAQ,IAAC,MAAK,CAAC,UAAf,CAAN;AAAA,IACA,GAAG,CAAC,WAAJ,GAAkB,YAAY,GAAG,CAAC,WAAhB,EAA6B,GAA7B,CADlB;AAAA,IAEA,GAAG,CAAC,QAAJ,GAAgB,IAAC,MAAK,CAAC,WAAP,EAFhB;AAGA,WAAO,GAAP,CAJW;EAAA,CANf;;AAAA,sBAYA,cAAa;AACT,QAAC,MAAD,GAAS,IAAC,EAAD,CAAG,KAAH,CAAT;AAAA,IACA,IAAC,MAAK,CAAC,IAAP,CAAY,KAAZ,EAAmB,IAAC,MAAK,CAAC,WAAP,EAAnB,CADA;WAEA,OAAO,CAAC,MAAR,CAAe,IAAC,MAAK,CAAC,UAAU,CAAC,WAAjC,EAA8C,IAAC,MAA/C,EAHS;EAAA,CAZb;;mBAAA;;GADqC,SALzC;;;;ACAA;EAAA;iSAAA;;AAAA,QAAQ,QAAQ,sBAAR,CAAR;;AAAA,KACA,GAAQ,QAAQ,iBAAR,CADR;;AAAA,MAIM,CAAC,OAAP,GAAuB;AAEnB;;;;GAAA;;AAAA,8BAAI,qBAAJ;;AAAA,yBACA,mBAAkB,QAAQ,sBAAR,CADlB;;AAAA,yBAEA,QAAO,EAAE,iBAAF,CAFP;;AAAA,yBAGA,UAAS,oBAHT;;AAAA,yBAKA,SAAQ;WAAG,CAAC,CAAC,MAAF,CAAS,oDAAT,EACP;AAAA,mBAAa,gBAAb;AAAA,MACA,gBAAgB,iBADhB;AAAA,MAEA,gBAAgB,iBAFhB;KADO,EAAH;EAAA,CALR;;AAAA,yBAUA,iBAAgB,SAAC,CAAD;WACZ,EAAE,CAAC,CAAC,MAAJ,CAAW,CAAC,WAAZ,CAAwB,UAAxB,EADY;EAAA,CAVhB;;AAAA,yBAaA,gBAAe;WAAG,IAAC,SAAJ;EAAA,CAbf;;AAAA,yBAeA,aAAY,SAAC,OAAD;AAER,QAAO,oBAAP;AACI,mDAAM,EAAN,EADJ;KAAA;AAEA,QAAO,oBAAP;AACI,aAAO,CAAC,IAAR,GAAe,CAAf,CADJ;KAFA;AAIA,QAAO,wBAAP;AACI,UAAC,QAAO,CAAC,QAAT,GAAoB,EAApB,CADJ;KAJA;AAAA,IAMA,IAAC,QAAO,CAAC,IAAT,GAAgB,OAAO,CAAC,IANxB;WASA,KAAK,CAAC,aAAN,CAAoB,OAAO,CAAC,IAA5B,EAAkC;aAAA,SAAC,GAAD,EAAM,IAAN;AAC9B;AAAA,YAAsB,4CAAtB;AAAA,kBAAQ,IAAI,CAAC,KAAb;SAAA;AAEA,YAAG,GAAH;AACI,iBAAO,OAAO,CAAC,GAAR,CAAY,GAAZ,CAAP,CADJ;SAAA,MAIK,IAAG,oBAAH;AACD,eAAC,QAAO,CAAC,KAAT,GAAiB,gBAAjB;AAAA,UACA,KAAC,QAAO,CAAC,OAAT,GAAmB,IAAI,CAAC,OADxB;AAAA,UAEA,iBACI,KAAE,OAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAzB,CAAmC,CAAnC,EAAF,GAAyC,WAH7C;AAAA,UAIA,SAAS,EAAE,CAAC,OAAH,CAAW,MAAM,CAAC,QAAQ,CAAC,MAA3B,EACL;AAAA,sBAAU,cAAV;WADK,CAJT;AAAA,UAMA,MAAM,CAAC,EAAP,CAAU,UAAV,EAAsB,SAAC,KAAD;AAClB;AAAA,iBAAC,QAAO,CAAC,OAAT,GAAmB,KAAK,CAAC,OAAzB;AACA,gBAAG,KAAC,QAAO,CAAC,OAAT,KAAoB,GAAvB;qBACI,KAAC,WAAD,CAAY,OAAZ,EADJ;aAAA;AAGI,yBAAW,KAAC,iBAAD,CAAkB,KAAC,cAAD,EAAlB,CAAX;qBACA,KAAC,EAAD,CAAG,aAAH,CAAiB,CAAC,IAAlB,CAAuB,QAAvB,EAJJ;aAFkB;UAAA,CAAtB,CANA,CADC;SAAA,MAgBA,IAAG,mBAAW,MAAM,CAAC,IAAP,CAAY,KAAZ,CAAkB,CAAC,MAAnB,KAA6B,CAA3C;AACD,eAAC,QAAO,CAAC,KAAT,GAAiB,iBAAjB,CADC;SAAA;AAKD,cAAmC,8CAAnC;AAAA,iBAAC,QAAO,CAAC,OAAT,GAAmB,IAAI,CAAC,OAAxB;WAAA;AAAA,UACA,KAAC,QAAO,CAAC,OAAT,GAAmB,OAAO,CAAC,IAAR,KAAkB,CADrC;AAAA,UAEA,KAAC,QAAO,CAAC,KAAT,GAAiB,MAAM,CAAC,IAAP,CAAY,KAAZ,CAFjB;AAAA,UAGA,KAAC,QAAO,CAAC,KAAK,CAAC,IAAf,CAAoB,SAAC,CAAD,EAAI,CAAJ;mBAChB,KAAK,CAAC,CAAC,aAAF,CAAgB,CAAhB,EADW;UAAA,CAApB,CAHA;AAAA,UAKA,KAAC,QAAO,CAAC,MAAT,GAAkB,KALlB,CALC;SAtBL;AAAA,QAkCA,KAAC,EAAD,CAAG,aAAH,CAAiB,CAAC,IAAlB,CAAuB,KAAC,iBAAD,CAAkB,KAAC,cAAD,EAAlB,CAAvB,CAlCA;AAAA,QAmCA,KAAC,EAAD,CAAG,aAAH,CAAiB,CAAC,SAAlB,CAA4B,CAA5B,CAnCA;AAqCA,YAAG,kDAAH;AACI;AAAA;eAAA;2BAAA;AACI,+BAAC,EAAD,CAAI,MAAE,GAAG,CAAC,EAAV,CAAgB,CAAC,WAAjB,CAA6B,UAA7B,GADJ;AAAA;0BADJ;SAtC8B;MAAA;IAAA,QAAlC,EAXQ;EAAA,CAfZ;;AAAA,yBAoEA,KAAI,SAAC,SAAD;AACA;AAAA;KAAA;WACA,IAAC,QAAO,CAAC,YAAT,CAAsB;aAAA,SAAC,KAAD;AAClB;AAAA,cAAM,EAAN;AAAA,QACA,KAAC,QAAO,CAAC,QAAS,MAAC,QAAO,CAAC,IAAT,CAAlB,GAAmC,KAAC,EAAD,CAAG,WAAH,CADnC;AAEA;AAAA;aAAA;0BAAA;AACI;;AAAA;iBAAA;6BAAA;AACI,uBAAS,GAAG,CAAC,EAAb;AAAA,cAGA,KAAK,CAAC,KAAN,GAAc,GAAG,CAAC,IAHlB;AAAA,cAIA,WAAe,UAAM,KAAN,CAJf;AAAA,cAKA,QAAQ,CAAC,IAAT,GAAgB,GALhB;AAAA,cAMA,GAAG,CAAC,IAAJ,CAAS,QAAT,CANA;AAAA,cAOA,IAAC,WAAU,CAAC,GAAZ,CAAgB,QAAhB,CAPA;AAAA,6BASA,KAAK,CAAC,YAAN,CAAmB,MAAnB,EAA2B,KAA3B,EAAkC;uBAAA,SAAC,GAAD,EAAM,KAAN;AAC9B,sBAA0B,GAA1B;AAAA,2BAAO,OAAO,CAAC,GAAR,CAAY,GAAZ,CAAP;mBAAA;AAAA,kBAEA,WAAW,GAAG,CAAC,GAAJ,EAFX;AAAA,kBAGA,KAAC,WAAU,CAAC,MAAZ,CAAmB,QAAnB,EAA6B;AAAA,2BAAO,IAAP;mBAA7B,CAHA;yBAIA,KAAC,WAAU,CAAC,GAAZ,CAAgB,KAAhB,EAAuB;AAAA,2BAAO,IAAP;mBAAvB,EAL8B;gBAAA;cAAA,QAAlC,EATA,CADJ;AAAA;;yBAAA,CADJ;AAAA;wBAHkB;MAAA;IAAA,QAAtB,EAFA;EAAA,CApEJ;;AAAA,yBA2FA,kBAAiB;AAEb;AAAA,QAAC,QAAO,CAAC,QAAS,KAAC,QAAO,CAAC,IAAT,CAAlB,GAAmC,IAAC,EAAD,CAAG,WAAH,CAAnC;AAAA,IACA,UACI;AAAA,YAAM,IAAC,QAAO,CAAC,IAAT,GAAgB,CAAtB;AAAA,MACA,UAAU,IAAC,QAAO,CAAC,QADnB;KAFJ;WAIA,IAAC,WAAD,CAAY,OAAZ,EANa;EAAA,CA3FjB;;AAAA,yBAmGA,kBAAiB;AAEb;AAAA,QAAC,QAAO,CAAC,QAAS,KAAC,QAAO,CAAC,IAAT,CAAlB,GAAmC,IAAC,EAAD,CAAG,WAAH,CAAnC;AAAA,IACA,UACI;AAAA,YAAM,IAAC,QAAO,CAAC,IAAT,GAAgB,CAAtB;AAAA,MACA,UAAU,IAAC,QAAO,CAAC,QADnB;KAFJ;WAIA,IAAC,WAAD,CAAY,OAAZ,EANa;EAAA,CAnGjB;;sBAAA;;GAFwC,MAJ5C;;;;ACAA;EAAA;;iSAAA;;AAAA,iBAAiB,QAAQ,qBAAR,CAAjB;;AAAA,OACA,GAAU,QAAQ,aAAR,CADV;;AAAA,YAEA,GAAe,QAAQ,WAAR,CAFf;;AAAA,SAGA,GAAY,QAAQ,aAAR,CAHZ;;AAAA,KAIA,GAAQ,QAAQ,cAAR,CAJR;;AAAA,cAKA,GAAiB,QAAQ,uBAAR,CALjB;;AAAA,GAMA,GAAM,QAAQ,aAAR,CANN;;AAAA,MASM,CAAC,OAAP,GAAuB;AACnB;;;;;;;;;;;;;GAAA;;AAAA,8BAAU,SAAV;;AAAA,mBAEA,WAAU,QAAQ,kBAAR,CAFV;;AAAA,mBAIA,aAAY;AACR;WAEA,IAAC,SAAD,CAAU,IAAC,WAAX,EAAuB,SAAvB,EAAkC,IAAC,mBAAnC,EAHQ;EAAA,CAJZ;;AAAA,mBAUA,cAAa;AACT;AAAA;AAAA,IACA,IAAC,IAAG,CAAC,QAAL,CAAc,UAAd,EACI;AAAA,cAAQ,IAAR;AAAA,MACA,SAAS,KADT;AAAA,MAEA,YAAY,IAAC,qBAFb;KADJ,EAIE,IAAC,iBAJH,CADA;AAUA,QAAG,EAAE,sCAAF,CAAyC,CAAC,MAA1C,KAAoD,CAAvD;AACI,QAAE,2BAAF,CACI,CAAC,MADL,CACY,+BADZ,EADJ;KAVA;AAAA,IAaA,IAAC,SAAD,GAAY,EAAE,4CAAF,CAbZ;AAAA,IAcA,IAAC,SAAQ,CAAC,MAAV,CAAiB,OAAjB,CAdA;AAAA,IAeA,IAAC,SAAQ,CAAC,MAAV,EAfA;AAgBA,QAAG,SAAS,CAAC,SAAS,CAAC,MAApB,CAA2B,SAA3B,MAA2C,EAA9C;AACI,kBAAY,WAAZ,CADJ;KAAA;AAGI,kBAAY,mBAAZ,CAHJ;KAhBA;AAAA,IAoBA,IAAC,SAAD,GAAY,EAAE,qHAEa,SAFb,GAEyB,2BAF3B,CAGR,CAAC,QAHO,CAGE,sCAHF,CApBZ;AAAA,IAwBA,IAAC,SAAQ,CAAC,EAAV,CAAa,OAAb,EAAsB,IAAC,WAAvB,CAxBA;AAAA,IA2BA,IAAC,aAAD,GAAgB,EAAE,sDAAF,CA3BhB;AAAA,IA4BA,IAAC,aAAY,CAAC,MAAd,CAAqB,OAArB,CA5BA;AAAA,IA6BA,IAAC,aAAY,CAAC,MAAd,EA7BA;AA8BA,aAAQ,aAAY,CAAC,MAArB;AACI,UAAC,aAAD,GACI,EAAE,2FAAF,CAEA,CAAC,QAFD,CAEU,sCAFV,CADJ,CADJ;KA9BA;AAAA,IAoCA,IAAC,SAAD,GAAY,IAAC,EAAD,CAAG,WAAH,CApCZ;AAAA,IAuCA,IAAC,SAAD,GAAY,EAAE,iDAAF,CAvCZ;AAAA,IAwCA,IAAC,SAAQ,CAAC,MAAV,CAAiB,OAAjB,CAxCA;AAAA,IAyCA,IAAC,SAAQ,CAAC,MAAV,EAzCA;AAAA,IA0CA,IAAC,SAAD,GAAY,EAAE,2FAAF,CAER,CAAC,QAFO,CAEE,sCAFF,CA1CZ;AAAA,IA6CA,IAAC,SAAQ,CAAC,EAAV,CAAa,OAAb,EAAsB,IAAC,eAAvB,CA7CA;AAAA,IAgDA,IAAC,UAAD,GAAa,EAAE,6CAAF,CAhDb;AAAA,IAiDA,IAAC,UAAS,CAAC,MAAX,CAAkB,OAAlB,CAjDA;AAAA,IAkDA,IAAC,UAAS,CAAC,MAAX,EAlDA;AAAA,IAmDA,IAAC,UAAD,GAAa,EAAE,qFAAF,CAET,CAAC,QAFQ,CAEC,sCAFD,CAnDb;AAAA,IAsDA,IAAC,UAAS,CAAC,EAAX,CAAc,OAAd,EAAuB,IAAC,YAAxB,CAtDA;AAwDA;AAAA;SAAA;uBAAA;AACI,wBAAI,CAAC,UAAL,GAAkB,IAAC,YAAnB,CADJ;AAAA;oBAzDS;EAAA,CAVb;;AAAA,mBAsEA,eAAc;WACV,IAAC,EAAD,CAAG,OAAH,CAAW,CAAC,MAAZ,CAAmB,CAAC,CAAC,IAAF,CAAO,IAAC,MAAR,MAAkB,CAAlB,IAAwB,GAAG,CAAC,IAAJ,KAAY,QAAvD,EADU;EAAA,CAtEd;;AAAA,mBA0EA,SAAQ;WACJ;AAAA,cAAa,gBAAb;AAAA,MACA,YAAa,YADb;AAAA,MAEA,aAAc,aAFd;AAAA,MAGA,oBAAoB,gBAHpB;AAAA,MAIA,sBAAsB,gBAJtB;MADI;EAAA,CA1ER;;AAAA,mBAkFA,iBAAgB,SAAC,GAAD;AACZ,QAAG,IAAC,QAAO,CAAC,QAAZ;AACI,UAAC,IAAG,CAAC,WAAL,CAAiB,UAAjB;AAAA,MACA,IAAC,YAAD,CAAa,GAAG,CAAC,YAAY,CAAC,KAA9B,CADA;AAAA,MAEA,GAAG,CAAC,eAAJ,EAFA;AAAA,MAGA,GAAG,CAAC,cAAJ,EAHA,CADJ;KAAA;AAKA,WAAO,KAAP,CANY;EAAA,CAlFhB;;AAAA,mBA2FA,aAAY,SAAC,GAAD;AACR,QAAG,IAAC,QAAO,CAAC,QAAZ;AACI,UAAC,IAAG,CAAC,QAAL,CAAc,UAAd;AAAA,MACA,GAAG,CAAC,cAAJ,EADA;AAAA,MAEA,GAAG,CAAC,eAAJ,EAFA,CADJ;KAAA;AAIA,WAAO,KAAP,CALQ;EAAA,CA3FZ;;AAAA,mBAkGA,cAAa,SAAC,GAAD;AACT,QAAG,IAAC,QAAO,CAAC,QAAZ;AACI,UAAC,IAAG,CAAC,WAAL,CAAiB,UAAjB;AAAA,MACA,GAAG,CAAC,cAAJ,EADA;AAAA,MAEA,GAAG,CAAC,eAAJ,EAFA,CADJ;KAAA;AAIA,WAAO,KAAP,CALS;EAAA,CAlGb;;AAAA,mBA2GA,aAAY,SAAC,GAAD;AACR;;MAAA,MAAO,EAAE,kCAAF,CAAqC,CAAC,IAAtC,CAA2C,KAA3C;KAAP;AAAA,IACA,QAAQ,GAAG,CAAC,KAAJ,CAAU,GAAV,CADR;AAAA,IAEA,KAAK,KAAM,MAAK,CAAC,MAAN,GAAe,CAAf,CAFX;AAAA,IAGA,KAAK,EAAE,CAAC,KAAH,CAAS,GAAT,CAAc,GAHnB;AAIA,WAAO,EAAP,CALQ;EAAA,CA3GZ;;AAAA,mBAmHA,aAAY;AACR;AAAA,SAAK,IAAC,WAAD,EAAL;AAAA,IACA,6DAAiC,CAAE,UAAU,CAAC,oBAD9C;AAAA,IAEA,iBACI,OAAO,CAAC,UAAR,CAAmB,WAAnB,EAAgC,EAAE,uBAAF,CAAhC,CAHJ;AAAA,IAIA,OAAO,CAAC,MAAR,CAAe,cAAf,EAA+B,EAAE,uBAAF,CAA/B,CAJA;4DAKmB,CAAE,IAArB,CAA0B;AAAA,mBAAa,cAAb;KAA1B,EACI;AAAA,eAAU;eAAA;iBACN,OAAO,CAAC,MAAR,CAAe,cAAf,EAA+B,EAAE,uBAAF,CAA/B,EADM;QAAA;MAAA,QAAV;KADJ,WANQ;EAAA,CAnHZ;;AAAA,mBA8HA,cAAa;AACT;AAAA,SAAK,IAAC,WAAD,EAAL;AAAA,IACA,6DAAiC,CAAE,UAAU,CAAC,oBAD9C;AAAA,IAEA,iBACI,OAAO,CAAC,WAAR,CAAoB,WAApB,EAAiC,EAAE,uBAAF,CAAjC,CAHJ;AAAA,IAIA,OAAO,CAAC,MAAR,CAAe,cAAf,EAA+B,EAAE,uBAAF,CAA/B,CAJA;4DAKmB,CAAE,IAArB,CAA0B;AAAA,mBAAa,cAAb;KAA1B,EACI;AAAA,eAAU;eAAA;iBACN,OAAO,CAAC,MAAR,CAAe,cAAf,EAA+B,EAAE,uBAAF,CAA/B,EADM;QAAA;MAAA,QAAV;KADJ,WANS;EAAA,CA9Hb;;AAAA,mBA0IA,iBAAgB;AACZ;AAAA,QAAC,SAAQ,CAAC,QAAV,CAAmB,UAAnB;AAAA,IACA,UAAU,IAAC,WAAD,EADV;AAAA,IAEA,IAAC,MAAK,CAAC,GAAP,CAAW,cAAX,EAA2B,OAA3B,CAFA;AAAA,IAGA,IAAC,MAAK,CAAC,GAAP,CAAW,OAAX,EAAoB,OAApB,CAHA;AAAA,IAIA,IAAC,MAAK,CAAC,GAAP,CAAW,UAAX,EAAuB,IAAC,MAAK,CAAC,WAAP,EAAvB,CAJA;WAKA,IAAC,MAAK,CAAC,IAAP,CAAY,IAAZ,EACI;AAAA,eAAS;eAAA;AACL,eAAC,SAAQ,CAAC,WAAV,CAAsB,UAAtB;iBACA,MAAM,EAAE,iCAAF,CAAN,EAFK;QAAA;MAAA,QAAT;AAAA,MAGA,OAAO;eAAA;AACH,eAAC,SAAQ,CAAC,WAAV,CAAsB,UAAtB;iBACA,MAAM,EAAE,qCAAF,CAAN,EAFG;QAAA;MAAA,QAHP;KADJ,EANY;EAAA,CA1IhB;;AAAA,mBAwJA,qBAAoB,SAAC,SAAD;AAChB,QAAG,SAAS,CAAC,EAAV,KAAgB,IAAC,MAAK,CAAC,GAAP,CAAW,cAAX,CAAnB;aACI,IAAC,MAAK,CAAC,IAAP,CAAY;AAAA,sBAAc,IAAd;OAAZ,EADJ;KADgB;EAAA,CAxJpB;;AAAA,mBA4JA,iBAAgB,SAAC,GAAD;AACZ;AAAA,QAAC,YAAD,CAAa,IAAC,SAAS,GAAE,CAAC,KAA1B;AAAA,IAEA,MAAM,IAAC,SAFP;AAAA,IAGA,IAAC,SAAD,GAAY,GAAG,CAAC,KAAJ,CAAU,IAAV,CAHZ;WAIA,GAAG,CAAC,WAAJ,CAAgB,IAAC,SAAjB,EALY;EAAA,CA5JhB;;AAAA,mBAmKA,uBAAsB,SAAC,IAAD;AAClB;AAAA,SAAK,IAAC,WAAD,CAAY,IAAI,CAAC,IAAjB,CAAL;AAAA,IACA,6DAAiC,CAAE,UAAU,CAAC,oBAD9C;WAEA,EAAE,yBAAF,CAA6B,GAAE,CAAC,OAAO,CAAC,WAAxC,GAAsD,YAHpC;EAAA,CAnKtB;;AAAA,mBAwKA,mBAAkB,SAAC,IAAD;AAEd;AAAA,UAAM,EAAE,uBAAF,CAA0B,CAAC,IAA3B,CAAgC,KAAhC,CAAN;AAAA,IACA,KAAK,IAAC,WAAD,EADL;AAAA,IAEA,IAAC,aAAY,CAAC,IAAd,CAAmB,MAAnB,EAA2B,GAAG,CAAC,OAAJ,CAAY,QAAZ,EAAsB,MAAtB,CAA3B,CAFA;AAAA,IAKA,SAAS,EAAE,0BAAF,CALT;AAMA;SAAA;yBAAA;AACI,YAAM,KAAK,CAAC,GAAZ;AAAA,MACA,QAAQ,GAAG,CAAC,KAAJ,CAAU,GAAV,CADR;AAAA,MAEA,KAAK,KAAM,MAAK,CAAC,MAAN,GAAe,CAAf,CAFX;AAAA,MAGA,KAAK,EAAE,CAAC,KAAH,CAAS,GAAT,CAAc,GAHnB;AAAA,MAIA,6DAAiC,CAAE,UAAU,CAAC,oBAJ9C;AAAA,oBAKA,OAAO,CAAC,MAAR,CAAe,WAAf,EAA4B,EAAE,KAAF,CAA5B,EALA,CADJ;AAAA;oBARc;EAAA,CAxKlB;;AAAA,mBAwLA,cAAa,SAAC,KAAD;WAGT,IAAC,QAAO,CAAC,YAAT,CAAsB;aAAA,SAAC,eAAD;AAElB;AAAA;2BAAA;AACI,yBAAe,CAAC,KAAhB,GAAwB,IAAI,CAAC,IAA7B;AAAA,UACA,QAAY,UAAM,eAAN,CADZ;AAAA,UAEA,KAAK,CAAC,IAAN,GAAa,IAFb;AAAA,UAGA,KAAC,WAAU,CAAC,GAAZ,CAAgB,KAAhB,CAHA;AAAA,UAIA,cAAc,CAAC,OAAf,CAAuB,KAAvB,CAJA,CADJ;AAAA;AAOA;AAAA;2BAAA;AACI,cAAI,CAAC,UAAL,GAAkB,KAAC,WAAnB,CADJ;AAAA,SAPA;eAUA,KAAK,CAAC,EAAN,CAAS,gBAAT,EAA2B;AACvB,cAAO,uCAAP;mBACI,KAAC,MAAK,CAAC,IAAP,CAAY;AAAA,4BAAc,KAAK,CAAC,GAAN,CAAU,IAAV,CAAd;aAAZ,EADJ;WADuB;QAAA,CAA3B,EAZkB;MAAA;IAAA,QAAtB,EAHS;EAAA,CAxLb;;AAAA,mBA2MA,iBAAgB;WACR,iBACA;AAAA,aAAO,IAAC,MAAR;AAAA,MACA,YAAY,IAAC,WADb;AAAA,MAEA,cAAc,IAAC,QAAO,CAAC,YAFvB;KADA,EADQ;EAAA,CA3MhB;;gBAAA;;GADkC,eATtC;;;;ACAA;EAAA;;iSAAA;;AAAA,WAAW,QAAQ,eAAR,CAAX;;AAAA,OACA,GAAU,QAAQ,aAAR,CADV;;AAAA,mBAGA,GAAsB,CAClB,eADkB,EACD,qBADC,EACsB,gBADtB,EACwC,iBADxC,CAErB,CAAC,IAFoB,CAEf,GAFe,CAHtB;;AAAA,MASM,CAAC,OAAP,GAAuB;AACnB;;;;;;GAAA;;AAAA,iCAAU,QAAQ,iBAAR,CAAV;;AAAA,sBACA,YAAW,OADX;;AAAA,sBAGA,aAAY,SAAC,OAAD;AACR;AAAA,IACA,IAAC,SAAD,CAAU,IAAC,MAAX,EAAkB,UAAlB,EAAqC,IAAC,WAAtC,CADA;AAAA,IAEA,IAAC,SAAD,CAAU,IAAC,MAAX,EAAkB,SAAlB,EAAqC,IAAC,UAAtC,CAFA;AAAA,IAGA,IAAC,SAAD,CAAU,IAAC,MAAX,EAAkB,SAAlB,EAAqC,IAAC,QAAtC,CAHA;AAAA,IAIA,IAAC,SAAD,CAAU,IAAC,MAAX,EAAkB,gBAAlB,EAAqC,IAAC,SAAtC,CAJA;WAKA,IAAC,SAAD,CAAU,IAAC,MAAX,EAAkB,QAAlB,EAAqC;aAAA;eAAG,KAAC,OAAD,GAAH;MAAA;IAAA,QAArC,EANQ;EAAA,CAHZ;;AAAA,sBAWA,SAAQ;WACJ;AAAA,eAAU,iBAAV;AAAA,MACA,iBAAkB,cADlB;MADI;EAAA,CAXR;;AAAA,sBAeA,gBAAe;WAAG,IAAC,MAAK,CAAC,WAAV;EAAA,CAff;;AAAA,sBAiBA,cAAa;AACT,QAAC,KAAD,GAAe,IAAC,EAAD,CAAG,GAAH,CAAf;AAAA,IACA,IAAC,MAAD,GAAe,IAAC,EAAD,CAAG,KAAH,CADf;AAAA,IAEA,IAAC,YAAD,GAAe,IAAC,EAAD,CAAG,eAAH,CAFf;AAAA,IAGA,OAAO,CAAC,MAAR,CAAe,IAAC,MAAK,CAAC,GAAP,CAAW,aAAX,CAAf,EAA0C,IAAC,MAA3C,CAHA;AAIA,aAAgC,MAAK,CAAC,KAAP,EAA/B;aAAA,IAAC,KAAI,CAAC,QAAN,CAAe,QAAf;KALS;EAAA,CAjBb;;AAAA,sBAwBA,cAAa,SAAC,OAAD;WACT,IAAC,YAAW,CAAC,GAAb,CAAiB,OAAjB,EAA0B,UAAU,GAApC,EADS;EAAA,CAxBb;;AAAA,sBA4BA,aAAY,SAAC,KAAD;WACR,IAAC,YAAD,CAAa,KAAK,KAAK,KAAK,CAAC,MAAX,GAAoB,KAAK,CAAC,KAA5C,EADQ;EAAA,CA5BZ;;AAAA,sBAgCA,YAAW;AACP,QAAC,YAAD,CAAa,EAAb;AAAA,IACA,IAAC,MAAK,CAAC,IAAP,CAAY,KAAZ,EAAmB,IAAC,MAAK,CAAC,QAA1B,CADA;AAAA,IAEA,IAAC,MAAK,CAAC,IAAP,CAAY,aAAZ,EAA2B,IAAC,MAAK,CAAC,GAAP,CAAW,aAAX,CAA3B,CAFA;WAGA,IAAC,MAAK,CAAC,QAAP,CAAgB,SAAhB,EAJO;EAAA,CAhCX;;AAAA,sBAwCA,WAAU;AAEN;AAAA,cAAc,WAAd;AAAA,IACA,OAAO,CAAC,OAAR,GAAkB,OAAO,CAAC,MAAR,GAAiB;aAAA;eAC/B,KAAC,OAAD,GAD+B;MAAA;IAAA,QADnC;WAIA,OAAO,CAAC,GAAR,GAAe,mBAAe,IAAC,MAAK,CAAC,EAAtB,GAA0B,OANnC;EAAA,CAxCV;;AAAA,sBAiDA,UAAS,SAAC,GAAD;AACL,QAAC,YAAD,CAAa,CAAb;AAAA,IACA,IAAC,MAAD,GAAS,IAAC,MAAK,CAAC,GAAP,CAAW,OAAX,IAAsB,GAAtB,GAA4B,GADrC;AAAA,IAEA,IAAC,KAAI,CAAC,IAAN,CAAW,OAAX,EAAoB,IAAC,MAArB,CAFA;WAGA,IAAC,MAAK,CAAC,IAAP,CAAY,KAAZ,EAAmB,eAAnB,EAJK;EAAA,CAjDT;;AAAA,sBAyDA,kBAAiB,SAAC,GAAD;AACb,QAAG,IAAC,MAAK,CAAC,KAAP,EAAH;AACI,UAAgB,IAAC,MAAjB;AAAA,cAAM,IAAC,MAAP;OAAA;AAAA,MACA,GAAG,CAAC,eAAJ,EADA;AAAA,MAEA,GAAG,CAAC,cAAJ,EAFA;AAGA,aAAO,KAAP,CAJJ;KADa;EAAA,CAzDjB;;AAAA,sBAgEA,eAAc;AACV,QAAC,EAAD,CAAG,SAAH,CAAa,CAAC,IAAd,CAAmB,0BAAnB;AAAA,IACA,IAAC,EAAD,CAAG,SAAH,CAAa,CAAC,IAAd,CAAmB,OAAnB,CADA;WAEA,IAAC,IAAG,CAAC,OAAL,CAAa;aAAA;eACT,KAAC,MAAK,CAAC,OAAP,CACI;AAAA,mBAAS;AACL,iBAAC,WAAU,CAAC,MAAZ,CAAmB,KAAC,MAApB;mBACA,KAAC,OAAD,GAFK;UAAA,CAAT;SADJ,EADS;MAAA;IAAA,QAAb,EAHU;EAAA,CAhEd;;mBAAA;;GADqC,SATzC","sourcesContent":["module.exports =\n\n    initialize: ->\n\n        window.app = this\n        # Translation helpers.\n        @locale = window.locale\n        @polyglot = new Polyglot()\n        try\n            locales = require 'locales/'+ @locale\n        catch e\n            locales = require 'locales/en'\n\n        @polyglot.extend locales\n        window.t = @polyglot.t.bind @polyglot\n\n        AlbumCollection = require('collections/album')\n        Router = require('router')\n\n        @router = new Router()\n\n        # Base data\n        @albums = new AlbumCollection()\n\n        @urlKey = \"\"\n        if window.location.search\n            for param in window.location.search.substring(1).split '&'\n                [key, value] = param.split '='\n                @urlKey = \"?key=#{value}\" if key is 'key'\n\n        @mode = if window.location.pathname.match /public/ then 'public'\n        else 'owner'\n\n        # Display albums. Fetch data if no data were loaded via server index.\n        if window.initalbums\n            @albums.reset window.initalbums, parse: true\n            delete window.initalbums\n            Backbone.history.start()\n        else\n            @albums.fetch().done -> Backbone.history.start()\n","# AlbumCollection\n# is a collection of Albums (models/album)\n# define the endpoint where Backbone will fetch the list of album\n\nmodule.exports = class AlbumCollection extends Backbone.Collection\n\n    model: require 'models/album'\n    url: 'albums' + app.urlKey\n","# PhotoCollection\n# is a collection of Photos (models/photo)\n# define the endpoint where Backbone will fetch the list of photos\n\nmodule.exports = class PhotoCollection extends Backbone.Collection\n\n    model: require 'models/photo'\n    url: -> 'photos' + app.urlKey\n    comparator: (model) -> model.get 'title'\n","app = require 'application'\n\n$ ->\n    jQuery.event.props.push 'dataTransfer'\n    app.initialize()\n\n    # Initialize Spin JS the lib that displays loading indicators\n    $.fn.spin = (opts, color) ->\n        presets =\n            tiny:\n                lines: 8\n                length: 2\n                width: 2\n                radius: 3\n\n            small:\n                lines: 8\n                length: 1\n                width: 2\n                radius: 5\n\n            large:\n                lines: 10\n                length: 8\n                width: 4\n                radius: 8\n\n        if Spinner\n            @each ->\n                $this = $(this)\n                spinner = $this.data(\"spinner\")\n                if spinner?\n                    spinner.stop()\n                    $this.data \"spinner\", null\n                else if opts isnt false\n                    if typeof opts is \"string\"\n                        if opts of presets\n                            opts = presets[opts]\n                        else\n                            opts = {}\n                        opts.color = color    if color\n                    spinner = new Spinner(\n                        $.extend(color: $this.css(\"color\"), opts))\n                    spinner.spin(this)\n                    $this.data \"spinner\", spinner\n\n        else\n            console.log \"Spinner class not available.\"\n            null\n","# BaseView used to DRY other views\n# - copy view options in view object\n# - pass the options, as well as getRenderData to the template\n# - render the template inside its el\n# provide a afterRender hook\n\nmodule.exports = class BaseView extends Backbone.View\n    initialize: (options) ->\n        @options = options\n\n    template: ->\n\n    getRenderData: ->\n\n    render: =>\n        data = _.extend {}, @options, @getRenderData()\n        @$el.html @template(data)\n        @afterRender()\n        this\n\n    afterRender: ->\n","\n# Make ajax request more easy to do.\n# Expected callbacks: success and error\nexports.request = (type, url, data, callbacks) ->\n\n    success = callbacks.success or (res) -> callbacks null, res\n    error = callbacks.error or (err) -> callbacks err\n\n\n    $.ajax\n        type: type\n        url: url\n        data: data\n        success: success\n        error: error\n\n# Sends a get request with data as body\n# Expected callbacks: success and error\nexports.get = (url, callbacks) ->\n    exports.request \"GET\", url, null, callbacks\n\n# Sends a post request with data as body\n# Expected callbacks: success and error\nexports.post = (url, data, callbacks) ->\n    exports.request \"POST\", url, data, callbacks\n\n# Sends a put request with data as body\n# Expected callbacks: success and error\nexports.put = (url, data, callbacks) ->\n    exports.request \"PUT\", url, data, callbacks\n\n# Sends a delete request with data as body\n# Expected callbacks: success and error\nexports.del = (url, callbacks) ->\n    exports.request \"DELETE\", url, null, callbacks\n","# Facilitator to allow user to copy url to clipboard in a easy way.\nmodule.exports = class Clipboard\n\n    constructor: ->\n        @value = \"\"\n\n        $(document).keydown (e) =>\n            # Check if value exist and if user wants to copy\n            if not @value or not(e.ctrlKey or e.metaKey)\n                return\n            if window.getSelection?()?.toString()\n                return\n\n            if document.selection?.createRange().text\n                return\n            _.defer =>\n                $clipboardContainer = $(\"#clipboard-container\")\n                $clipboardContainer.empty().show()\n                $(\"<textarea id='clipboard'></textarea>\")\n                .val(@value)\n                .appendTo($clipboardContainer)\n                .focus()\n                .select()\n\n        $(document).keyup (e) =>\n            if $(e.target).is(\"#clipboard\")\n                $(\"<textarea id='clipboard'></textarea>\").val(\"\")\n                $(\"#clipboard-container\").empty().hide()\n\n    set: (value) =>\n        @value = value\n","module.exports =\n\n    # Simple shortener to display of a long text\n    # used for album descriptions on AlbumList page\n    # @TODO: make this HTML resistant\n    limitLength: (string, length) ->\n        if string? and string.length > length\n        then string.substring(0, length) + '...'\n        else string\n\n    # Focus a given element (required for content editable elements).\n    forceFocus: (el) ->\n        range = document.createRange()\n        range.selectNodeContents el[0]\n        sel = document.getSelection()\n        sel.removeAllRanges()\n        sel.addRange(range)\n        el.focus()\n\n    ## Helpers to rotate photos\n    # TODO refactor it with switch\n\n    rotate: (orientation, image) ->\n        if navigator.userAgent.search(\"Firefox\") isnt -1\n            transform = \"transform\"\n        else\n            transform = \"-webkit-transform\"\n        if orientation is undefined or orientation is 1\n            image.css transform, \"rotate(\" + 0 + \"deg)\"\n            return\n        else if orientation is 2\n            image.css transform, \"scale(-1, 1)\"\n        else if orientation is 3\n            image.css transform, \"rotate(\" + 180 + \"deg)\"\n        else if orientation is 4\n            image.css transform, \"scale(1, -1)\"\n        else if orientation is 5\n            image.css transform, \"rotate(\" + -90 + \"deg) scale(-1, 1) \"\n        else if orientation is 6\n            image.css transform, \"rotate(\" + 90 + \"deg)\"\n        else if orientation is 7\n            image.css transform, \"rotate(\" + 90 + \"deg) scale(-1, 1)\"\n        else if orientation is 8\n            image.css transform, \"rotate(\" + -90 + \"deg)\"\n\n    getRotate: (orientation, image) ->\n        if navigator.userAgent.search(\"Firefox\") isnt -1\n            transform = \"transform\"\n        else\n            transform = \"-webkit-transform\"\n        if orientation is undefined or orientation is 1\n            return transform + \": rotate(\" + 0 + \"deg)\"\n        else if orientation is 2\n            return transform + \": scale(-1, 1)\"\n        else if orientation is 3\n            return transform + \": rotate(\" + 180 + \"deg)\"\n        else if orientation is 4\n            return transform + \": scale(1, -1)\"\n        else if orientation is 5\n            return transform + \": rotate(\" + -90 + \"deg) scale(-1, 1) \"\n        else if orientation is 6\n            return transform + \": rotate(\" + 90 + \"deg)\"\n        else if orientation is 7\n            return transform + \": rotate(\" + 90 + \"deg) scale(-1, 1)\"\n        else if orientation is 8\n            return transform + \": rotate(\" + -90 + \"deg)\"\n\n    rotateLeft: (orientation, image) ->\n        if orientation is undefined or orientation is 1\n            return 8\n        else if orientation is 2\n            return 5\n        else if orientation is 3\n            return 6\n        else if orientation is 4\n            return 7\n        else if orientation is 5\n            return 4\n        else if orientation is 6\n            return 1\n        else if orientation is 7\n            return 2\n        else if orientation is 8\n            return 3\n\n    rotateRight: (orientation, image) ->\n        if orientation is undefined or orientation is 1\n            return 6\n        else if orientation is 2\n            return 7\n        else if orientation is 3\n            return 8\n        else if orientation is 4\n            return 5\n        else if orientation is 5\n            return 2\n        else if orientation is 6\n            return 3\n        else if orientation is 7\n            return 4\n        else if orientation is 8\n            return 1\n","BaseView = require '../lib/base_view'\n\nmodule.exports = class ModalView extends BaseView\n\n    id: \"dialog-modal\"\n    className: \"modal fade\"\n    attributes:\n        'tab-index': -1\n    template: require './templates/modal'\n    value: 0\n\n    events: ->\n        \"click #modal-dialog-no\"  : \"onNo\"\n        \"click #modal-dialog-yes\" : \"onYes\"\n\n    constructor: (@title, @msg, @yes, @no, @cb, @hideOnYes) ->\n        super()\n        @hideOnYes = true unless @hideOnYes?\n\n    initialize: ->\n        @$el.on 'hidden.bs.modal', => @close()\n\n        @render()\n        @show()\n\n    onYes: ->\n        @cb true if @cb\n        @hide()\n\n    onNo: ->\n        @cb false if @cb\n        @hide() if @hideOnYes\n\n    onShow: ->\n\n    close: ->\n        setTimeout (() => @destroy()), 500\n\n    show: ->\n        @$el.modal 'show'\n        @$el.trigger 'show'\n\n    hide: ->\n        @$el.modal 'hide'\n        @$el.trigger 'hide'\n\n    render: ->\n        @$el.append @template(title: @title, msg: @msg, yes: @yes, no: @no)\n        $(\"body\").append @$el\n        @afterRender()\n        @\n\nmodule.exports.error = (code, cb) ->\n    new ModalView t(\"modal error\"), code, t(\"modal ok\"), false, cb\n","BaseView = require 'lib/base_view'\n\n# View that display a collection of subitems\n# used to DRY views\n# Usage : new ViewCollection(collection:collection)\n# Automatically populate itself by creating a itemView for each item\n# in its collection\n\n# can use a template that will be displayed alongside the itemViews\n\n# itemView       : the Backbone.View to be used for items\n# itemViewOptions : the options that will be passed to itemViews\n\nmodule.exports = class ViewCollection extends BaseView\n\n    views: {}\n\n    itemView: null\n\n\n    itemViewOptions: ->\n\n    # add 'empty' class to view when there is no subview\n    checkIfEmpty: ->\n        @$el.toggleClass 'empty', _.size(@views) is 0\n\n    # can be overriden if we want to place the subviews somewhere else\n    appendView: (view) ->\n\n        index = @collection.indexOf view.model\n\n        @$el.append view.$el\n        # if index is 0\n        # else\n\n        #     className = if view.className? then \".#{view.className}\"\n        #     else \"\"\n\n        #     tagName = view.tagName or \"\"\n\n        #     selector = \"#{tagName}#{className}:nth-of-type(#{index})\"\n        #     @$el.find(selector).after view.$el\n\n\n    # bind listeners to the collection\n    initialize: ->\n        super\n        @views = {}\n        @listenTo @collection, \"reset\",   @onReset\n        @listenTo @collection, \"add\",     @addItem\n        @listenTo @collection, \"sort\",    @render\n        @listenTo @collection, \"remove\",  @removeItem\n        @onReset @collection\n\n    # if we have views before a render call, we detach them\n    render: ->\n        view.$el.detach() for id, view of @views\n        super\n\n    # after render, we reattach the views\n    afterRender: ->\n        if @collection.length > 0\n            for i in [0..@collection.length-1]\n                @appendView @views[@collection.at(i).cid]\n\n            @checkIfEmpty @views\n\n    # destroy all sub views before remove\n    remove: ->\n        @onReset []\n        super\n\n    # event listener for reset\n    onReset: (newcollection) ->\n        view.remove() for id, view of @views\n        newcollection.forEach @addItem\n\n    # event listeners for add\n    addItem: (model) =>\n        options = _.extend {}, {model: model}, @itemViewOptions(model)\n        view = new @itemView(options)\n        @views[model.cid] = view.render()\n        @appendView view\n        @checkIfEmpty @views\n\n    # event listeners for remove\n    removeItem: (model) =>\n        @views[model.cid].remove()\n        delete @views[model.cid]\n        @checkIfEmpty @views\n\n","module.exports =\n\n    \"Back\" : \"Back\"\n    \"Create a new album\" : \"Create a new album\"\n    \"Delete\" : \"Delete\"\n    \"Download\" : \"Download\"\n    \"Edit\" : \"Edit\"\n    \"Stop editing\" : \"Save Changes\"\n    \"It will appear on your homepage.\" : \"It will be displayed on the album page.\"\n    \"Make it Hidden\" : \"hidden\"\n    \"Make it Private\" : \"private\"\n    \"Make it Public\" : \"public\"\n    \"New\" : \"New\"\n    \"private\" : \"private\"\n    \"public\" : \"public\"\n    \"hidden\" : \"hidden\"\n    \"There is no photos in this album\" : \"There is no photo in this album. Click on Edit button to add new ones.\"\n    \"There is no public albums.\" : \"There are no album.\"\n    \"This album is private\" : \"This album is private\"\n    \"This album is hidden\" : \"This album is hidden\"\n    \"This album is public\" : \"This album is public\"\n    \"Title ...\" : \"Set a title for this album...\"\n    \"View\" : \"View\"\n    \"Write some more ...\" : \"Write a description...\"\n    \"is too big (max 10Mo)\":\"is too big (max 10Mo)\"\n    \"is not an image\": \"is not an image\"\n    \"Share album by mail\": \"Share album by mail\"\n    \"Upload your contacts...\": \"Upload your contacts...\"\n    \"Share album\": \"Share album\"\n    \"Add contact\": \"Add contact\"\n    \"Send mail\": \"Send mail\"\n    \"Select your friends\": \"Select your friends\"\n    \"Add\": \"Add\"\n    \"Cancel\": \"Cancel\"\n    'photo successfully set as cover': '''\n        The picture has been successfully set as album cover'''\n    'problem occured while setting cover': '''\n        A problem occured while setting picture as cover'''\n\n\n    \"pick from computer\":\"\"\"\n        Click here or drag your photos below to add them to the album.\n    \"\"\"\n    \"pick from files\":\"\"\"\n        Click here to pick pictures from the Files app.\n    \"\"\"\n\n    \"hidden-description\": \"\"\"\n      It will not appear on your homepage.\n      But you can share it with the following url:\n    \"\"\"\n\n    \"It cannot be accessed from the public side\" : \"\"\"\n      It is not a public resource.\"\n    \"\"\"\n    \"rebuild thumbnails\": \"Rebuild thumbnails\"\n\n    '01': 'January'\n    '02': 'February'\n    '03': 'March'\n    '04': 'April'\n    '05': 'May'\n    '06': 'June'\n    '07': 'July'\n    '08': 'August'\n    '09': 'September'\n    '10': 'October'\n    '11': 'November'\n    '12': 'December'\n    # clearance modal\n    \"cancel\" : \"Cancel\"\n    \"copy paste link\" : \"To give access to your contact send him/her the link below:\"\n    \"details\" : \"Details\"\n    \"inherited from\" : \"inherited from\"\n    \"modal question album shareable\" : \"Select share mode for this album\"\n    \"modal shared album custom msg\" : \"Enter email and press enter\"\n    \"modal shared album link msg\" : \"Send this link to let people access this album\"\n    \"modal send mails\" : \"Send a notification\"\n    \"only you can see\" : \"Only you and the people listed below can access this resource\"\n    \"public\" : \"Public\"\n    \"private\" : \"Private\"\n    \"shared\" : \"Shared\"\n    \"save\" : \"Save\"\n    \"see link\" : \"See link\"\n    \"send mails question\" : \"Send a notification email to:\"\n    \"sharing\" : \"Sharing\"\n    \"revoke\" : \"Revoke\"\n    \"confirm\" : \"Confirm\"\n    \"share forgot add\" : \"\"\"\nLooks like you forgot to click the Add button\n\"\"\"\n    \"share confirm save\" : \"\"\"\nThe changes you made to the permissions will not be saved. Do you want to continue?\n\"\"\"\n    \"yes forgot\" : \"Back\"\n    \"no forgot\" : \"It's ok\"\n    \"perm\" : \"can \"\n    \"perm r album\" : \"browse this album\"\n    \"perm rw album\" : \"browse and upload photos\"\n    \"change notif\" : \"\"\"\nCheck this box to be notified when a contact\nwill add a photo to this album.\"\"\"\n    \"send email hint\": \"Notification emails will be sent one time on save\"\n    \"yes\" : \"Yes\"\n    \"no\" : \"No\"\n    \"pictures\": \"pictures\"\n    \"are you sure you want to delete this album\": \"Are you sure you want to delete this album?\"\n    \"photos search\"   : \"Loading ...\"\n    \"no photos found\" : \"No photos found\"\n    \"thumb creation\"  : \"Application creates thumbs for files.\"\n    \"progress\"        : \"Progression\"\n","module.exports =\n    \"Back\" : \"Retour\"\n    \"Create a new album\" : \"Créer un nouvel album\"\n    \"Delete\" : \"Supprimer\"\n    \"Download\" : \"Télécharger\"\n    \"Edit\" : \"Modifier\"\n    \"Stop editing\" : \"Enregistrer les modifications\"\n    \"It will appears on your homepage.\" : \"Il apparaîtra sur votre page d'accueil\"\n    \"Make it Hidden\" : \"masqué\"\n    \"Make it Private\" : \"privé\"\n    \"Make it Public\" : \"public\"\n    \"New\" : \"Nouveau\"\n    \"private\" : \"privé\"\n    \"public\" : \"public\"\n    \"hidden\" : \"masqué\"\n    \"There is no photos in this album\" : \"Pas de photos dans cet album\"\n    \"There is no public albums.\" : \"Il n'y a aucun album\"\n    \"This album is private\" : \"Cet album est privé\"\n    \"This album is hidden\" : \"Cet album est masqué\"\n    \"This album is public\" : \"Cet album est public\"\n    \"Title ...\" : \"Titre...\"\n    \"Write some more ...\" : \"Description...\"\n    \"View\" : \"Voir\"\n    \"is too big (max 10Mo)\":\"est trop grosse (max 10Mo)\"\n    \"is not an image\": \"n'est pas une image\"\n    \"Share album by mail\": \"Partagez par mail\"\n    \"Upload your contacts ...\": \"Uploadez vos contacts...\"\n    \"Share album\": \"Partagez l'album\"\n    \"Add contact\": \"Ajouter contact\"\n    \"Send mail\": \"Envoyez mail\"\n    \"Select your friends\": \"Choisissez vos amis\"\n    \"Add\": \"Ajouter\"\n    \"Cancel\": \"Annuler\"\n    'photo successfully set as cover': '''\n        L'image est maintenant la couverture de l'album.'''\n    'problem occured while setting cover': '''\n        Un problème est survenu en positionnant l'image comme couverture de\n        l'album.'''\n\n    \"pick from computer\":\"\"\"\n        Cliquez ici ou glissez-déposez vos photos pour ajouter des images\n    \"\"\"\n    \"pick from files\":\"\"\"\n        Cliquez ici pour importer des images de l'application Files\n    \"\"\"\n\n    \"hidden-description\": \"\"\"\n      Il n'apparaîtra pas sur votre page d'accueil,\n      Mais vous pouvez partager cette URL :\n    \"\"\"\n\n    \"It cannot be accessed from the public side\" : \"\"\"\n      Il ne peut pas être vu depuis le côté public\n    \"\"\"\n\n    \"rebuild thumbnails\": \"Regénérer les vignettes\"\n\n    '01': 'Janvier'\n    '02': 'Février'\n    '03': 'Mars'\n    '04': 'Avril'\n    '05': 'Mai'\n    '06': 'Juin'\n    '07': 'Juillet'\n    '08': 'Août'\n    '09': 'Septembre'\n    '10': 'Octobre'\n    '11': 'Novembre'\n    '12': 'Décembre'\n     # clearance modal\n    \"also have access\" : \"Ces personnes ont également accès, car elles ont accès à un dossier parent\"\n    \"cancel\" : \"Annuler\"\n    \"copy paste link\" : \"Pour donner accès à votre contact envoyez-lui ce lien : \"\n    \"details\" : \"Détails\"\n    \"inherited from\" : \"hérité de\"\n    \"modal question album shareable\" : \"Choisissez le mode de partage pour cet album\"\n    \"modal shared album custom msg\" : \"Entrez un email et appuyez sur Entrée\"\n    \"modal shared album link msg\" : \"Envoyez ce lien pour donner accès à cet album\"\n    \"only you can see\" : \"Seuls vous et les personnes ci-dessous peuvent accéder à cette ressource.\"\n    \"public\" : \"Public\"\n    \"private\" : \"Privé\"\n    \"shared\" : \"Partagé\"\n    \"save\" : \"Sauvegarder\"\n    \"see link\" : \"Voir le lien\"\n    \"sharing\" : \"Partage\"\n    \"revoke\" : \"Révoquer la permission\"\n    \"send mails question\" : \"Envoyer un email de notification à : \"\n    \"modal send mails\" : \"Envoyer une notification\"\n    \"forced public\" : \"Ce dossier est public car un dossier parent est public : \"\n    \"confirm\" : \"Confirmer\"\n    \"share forgot add\" : \"\"\"\nIl semble que vous ayez oublié d'appuyer sur le boutton Ajouter\n\"\"\"\n    \"share confirm save\" : \"\"\"\nLes changements effectués sur les permissions ne seront pas sauvegardées. Etes vous sûr ?\n\"\"\"\n    \"yes forgot\" : \"Retour\"\n    \"no forgot\" : \"Ok\"\n    \"perm\" : \"peut \"\n    \"r\" : \"lire cet album\"\n    \"perm r album\" : \"parcourir cet album\"\n    \"perm rw album\" : \"parcourir cet album et ajouter des photos\"\n    \"change notif\" : \"\"\"\nCocher cette case pour recevoir une notification cozy quand un contact\najoute une photo à cet album.\"\"\"\n    \"send email hint\": \"Des emails de notification seront envoyés lors de la première sauvegarde.\"\n    \"yes\" : \"Oui\"\n    \"no\" : \"Non\"\n    \"pictures\": \"photos\"\n    \"are you sure you want to delete this album\": \"Etes vous sûr de vouloir effacer cet album ?\"\n    \"photos search\"   : \"Recherche des photos...\"\n    \"no photos found\" : \"Aucune photo trouvée...\"\n    \"thumb creation\"  : \"L'application est entrain de créer des minatures pour vos photos afin d'améliorer votre navigation.\"\n    \"progress\"        : \"Progression\"\n","PhotoCollection = require 'collections/photo'\nclient = require \"../lib/client\"\n\n# An album\n# Properties :\n# - photos : a PhotoCollection of the photo in this album\n# maintains attribute\n\nmodule.exports = class Album extends Backbone.Model\n\n    urlRoot: 'albums'\n\n    defaults: ->\n        title: ''\n        description: ''\n        clearance: []\n        thumbsrc: 'img/nophotos.gif'\n        orientation: 1\n\n    url: -> super + app.urlKey\n\n    constructor: ->\n        @photos = new PhotoCollection()\n        return super\n\n    # Build orientation and cover thumb src from photo attribute/\n    parse: (attrs) ->\n\n        if attrs.photos?.length > 0\n            @photos.reset attrs.photos, parse: true\n        delete attrs.photos\n\n\n        if attrs.coverPicture and attrs.coverPicture isnt 'null'\n            attrs.thumb = attrs.coverPicture\n            attrs.thumbsrc = \"photos/thumbs/#{attrs.coverPicture}.jpg\"\n            if @photos.get(attrs.coverPicture)?.attributes?.orientation?\n                attrs.orientation =\n                    @photos._byId[attrs.coverPicture].attributes.orientation\n\n        if attrs.clearance is 'hidden'\n            attrs.clearance = 'public'\n\n        if attrs.clearance is 'private'\n            attrs.clearance = []\n\n        return attrs\n\n    # Build cover thumb src from coverPicture field.\n    getThumbSrc: ->\n        coverPicture = @get 'coverPicture'\n        if coverPicture?\n            thumbSrc = \"photos/thumbs/#{@get 'coverPicture'}.jpg\"\n        else\n            thumbSrc = \"img/nophotos.gif\"\n        return thumbSrc + app.urlKey\n\n    getPublicURL: (key) ->\n        urlKey = if key then \"?key=#{key}\" else \"\"\n        \"#{window.location.origin}/public/photos/#{urlKey}#albums/#{@id}\"\n\n    # Send sharing email for this album.\n    sendMail: (url, mails, callback) ->\n        data =\n            url: url\n            mails: mails\n        client.post \"albums/share\", data, callback\n","client = require('../lib/client')\n\n# A photo\n# maintains attributes src / thumbsrc depending of the state of the model\nmodule.exports = class Photo extends Backbone.Model\n\n    defaults: ->\n        thumbsrc: 'img/loading.gif'\n        src: ''\n        orientation: 1\n\n    url: ->\n        super + app.urlKey\n\n    # build img src attributes from id.\n    parse: (attrs) ->\n        if not attrs.id then attrs\n        else _.extend attrs,\n            thumbsrc: \"photos/thumbs/#{attrs.id}.jpg\" + app.urlKey\n            src: \"photos/#{attrs.id}.jpg\" + app.urlKey\n            orientation: attrs.orientation\n\n    # Return screen size photo src built from id.\n    getPrevSrc: ->\n        \"photos/#{@get 'id'}.jpg\"\n\nPhoto.listFromFiles = (page, callback)->\n    client.get \"files/#{page}\", callback\n\nPhoto.makeFromFile = (fileid, attr, callback) ->\n    client.post \"files/#{fileid}/toPhoto\", attr, callback","# read the file from photo.file using a FileReader\n# create photo.img : an Image object\nreadFile = (photo, next) ->\n    if photo.file.size > 10 * 1024 * 1024\n        return next t 'is too big (max 10Mo)'\n\n    if not photo.file.type.match /image\\/.*/\n        return next t 'is not an image'\n\n    reader = new FileReader()\n    photo.img = new Image()\n\n    reader.readAsDataURL photo.file\n    reader.onloadend = =>\n        photo.img.src = reader.result\n        photo.img.orientation = photo.attributes.orientation\n        photo.img.onload = ->\n            next()\n\n# resize an image into given dimensions\n# if fill, the image will be croped to fit in new dim\nresize = (photo, MAX_WIDTH, MAX_HEIGHT, fill) ->\n\n    max = width: MAX_WIDTH, height: MAX_HEIGHT\n    if (photo.img.width > photo.img.height) is fill\n        ratiodim = 'height'\n    else\n        ratiodim = 'width'\n\n    ratio = max[ratiodim] / photo.img[ratiodim]\n\n    newdims =\n        height: ratio * photo.img.height\n        width: ratio * photo.img.width\n\n    # use canvas to resize the image\n    canvas = document.createElement 'canvas'\n    canvas.width  = if fill then MAX_WIDTH  else newdims.width\n    canvas.height = if fill then MAX_HEIGHT else newdims.height\n    ctx = canvas.getContext '2d'\n    ctx.drawImage photo.img, 0, 0, newdims.width, newdims.height\n    return canvas.toDataURL photo.file.type\n\n# transform a dataUrl into a Blob\nblobify = (dataUrl, type) ->\n    binary = atob dataUrl.split(',')[1]\n    array = []\n    for i in [0..binary.length]\n        array.push binary.charCodeAt i\n    return new Blob [new Uint8Array(array)], type: type\n\n\n# create photo.thumb_du : a DataURL encoded thumbnail of photo.img\nmakeThumbDataURI = (photo, next) ->\n    photo.thumb_du = resize photo, 300, 300, true\n    photo.trigger 'thumbed'\n    next()\n\n# create photo.screen_du : a DataURL encoded thumbnail of photo.img\nmakeScreenDataURI = (photo, next) ->\n    photo.screen_du = resize photo, 1200, 800, false\n    next()\n\n# create photo.thumb : a Blob(~File) copy of photo.thumb_du\nmakeScreenBlob = (photo, next) ->\n    photo.thumb = blobify photo.thumb_du, photo.file.type\n    next()\n\n# create photo.screen : a Blob(~File) copy of photo.screen_du\nmakeThumbBlob = (photo, next) ->\n    photo.screen = blobify photo.screen_du, photo.file.type\n    next()\n\n\n# create a FormData object with photo.file, photo.thumb, photo.screen\n# save the model with these files\nupload = (photo, next) ->\n    formdata = new FormData()\n    for attr in ['title', 'description', 'albumid', 'orientation']\n        formdata.append attr, photo.get attr\n\n    formdata.append 'raw', photo.file\n    formdata.append 'thumb', photo.thumb, \"thumb_#{photo.file.name}\"\n    formdata.append 'screen', photo.screen, \"screen_#{photo.file.name}\"\n    # need to call sync directly so we can change the data\n    Backbone.sync 'create', photo,\n        contentType: false # Prevent $.ajax from being smart\n        data: formdata\n        success: (data) ->\n            photo.set photo.parse(data), silent: true\n            next()\n        error: ->\n            next t ' : upload failled' # clear tmps anyway\n        xhr: -> # add progress listener to XHR\n            xhr = $.ajaxSettings.xhr()\n            progress = (e) -> photo.trigger 'progress', e\n\n            if xhr instanceof window.XMLHttpRequest\n                xhr.addEventListener 'progress', progress, false\n            if xhr.upload\n                xhr.upload.addEventListener 'progress', progress, false\n            xhr\n\n# make all thumbs fast\nmakeThumbWorker = (photo , done) ->\n    async.waterfall [\n        (cb) -> readFile         photo, cb\n        (cb) -> makeThumbDataURI photo, cb\n        (cb) ->\n            delete photo.img\n            setTimeout cb, 200\n    ], (err) ->\n        if err\n            photo.trigger 'upError', err\n        else\n            photo.trigger 'thumbed'\n\n        if err\n            done err\n        else\n            console.log photo\n            uploadWorker photo, done\n        #done(err)\n\n# make screen sized version and upload\nuploadWorker = (photo, done) ->\n    async.waterfall [\n        (cb) -> readFile          photo, cb\n        (cb) -> makeThumbDataURI photo, cb\n        (cb) -> makeScreenDataURI photo, cb\n        (cb) -> makeScreenBlob    photo, cb\n        (cb) -> makeThumbBlob     photo, cb\n        (cb) -> upload            photo, cb\n        (cb) ->\n            # the photo is now backed by the server\n            # delete all object attached to the photo\n            delete photo.file\n            delete photo.img\n            delete photo.thumb\n            delete photo.thumb_du\n            delete photo.scren\n            delete photo.screen_du\n            setTimeout cb, 200\n    ], (err) ->\n        if err\n            photo.trigger 'upError', err\n        else\n            photo.trigger 'uploadComplete'\n\n        done err\n\n\nclass PhotoProcessor\n\n    # create thumbs 3 by 3\n    #thumbsQueue: async.queue makeThumbWorker, 2\n\n    # upload 2 by 2\n    uploadQueue: async.queue uploadWorker, 2\n\n    process: (photo) ->\n        #@thumbsQueue.push photo, (err) =>\n        #    return console.log err if err\n        @uploadQueue.push photo, (err) =>\n             return console.log err if err\n\nmodule.exports = new PhotoProcessor()\n","# Create an image node to get thumb prev data\nreadFile = (photo, next) ->\n\n    photo.img = new Image()\n    photo.img.onload = ->\n        next()\n    photo.img.src = photo.url\n\n\n# resize an image into given dimensions\n# if fill, the image will be croped to fit in new dim\nresize = (photo, MAX_WIDTH, MAX_HEIGHT, fill) ->\n\n    max = width: MAX_WIDTH, height: MAX_HEIGHT\n    if (photo.img.width > photo.img.height) is fill\n        ratiodim = 'height'\n    else\n        ratiodim = 'width'\n\n    ratio = max[ratiodim] / photo.img[ratiodim]\n\n    newdims =\n        height: ratio * photo.img.height\n        width: ratio * photo.img.width\n\n    # use canvas to resize the image\n    canvas = document.createElement 'canvas'\n    canvas.width  = if fill then MAX_WIDTH  else newdims.width\n    canvas.height = if fill then MAX_HEIGHT else newdims.height\n    ctx = canvas.getContext '2d'\n    ctx.drawImage photo.img, 0, 0, newdims.width, newdims.height\n    return canvas.toDataURL photo.file.type\n\n# transform a dataUrl into a Blob\nblobify = (dataUrl, type) ->\n    binary = atob dataUrl.split(',')[1]\n    array = []\n    for i in [0..binary.length]\n        array.push binary.charCodeAt i\n    return new Blob [new Uint8Array(array)], type: type\n\n\n# create photo.thumb_du : a DataURL encoded thumbnail of photo.img\nmakeThumbDataURI = (photo, next) ->\n    photo.thumb_du = resize photo, 300, 300, true\n    setTimeout next, 1\n\n# create photo.screen : a Blob(~File) copy of photo.screen_du\nmakeThumbBlob = (photo, next) ->\n    photo.thumb = blobify photo.thumb_du, photo.file.type\n    setTimeout next, 1\n\n\n# create a FormData object with photo.file, photo.thumb, photo.screen\n# save the model with these files\nupload = (photo, next) ->\n    formdata = new FormData()\n    formdata.append 'thumb', photo.thumb, \"thumb_#{photo.file.name}\"\n    $.ajax\n        url: \"photos/thumbs/#{photo.id}.jpg\"\n        data: formdata\n        cache: false\n        contentType: false\n        processData: false\n        type: 'PUT',\n        success: (data) ->\n            $(\"#rebuild-th\").append \"<p>#{photo.file.name} photo updated.</p>\"\n\n\n\n# make thumb and upload\nuploadWorker = (photo, done) ->\n    async.waterfall [\n        (cb) -> readFile          photo, cb\n        (cb) -> makeThumbDataURI photo, cb\n        (cb) -> makeThumbBlob     photo, cb\n        (cb) -> upload            photo, cb\n        (cb) ->\n            delete photo.img\n            delete photo.thumb\n            delete photo.thumb_du\n            cb()\n    ], (err) ->\n        done(err)\n\n\nclass ThumbProcessor\n\n    # upload 2 by 2\n    uploadQueue: async.queue uploadWorker, 2\n\n    process: (model) ->\n\n        photo =\n            url: model.getPrevSrc()\n            id: model.get 'id'\n            file:\n                type: 'image/jpeg'\n                name: model.get 'title'\n\n        #setTimeout =>\n            #@uploadQueue.push photo, (err) =>\n                #return console.log err if err\n        #, 300\n        uploadWorker photo, (err) ->\n            console.log err if err\n\n\nmodule.exports = new ThumbProcessor()\n","app            = require 'application'\nAlbumsListView = require 'views/albumslist'\nAlbumView      = require 'views/album'\nAlbum          = require 'models/album'\n\nmodule.exports = class Router extends Backbone.Router\n    routes:\n        ''                    : 'albumslist'\n        'albums'              : 'albumslist'\n        'albums/edit'         : 'albumslistedit'\n        'albums/new'          : 'newalbum'\n        'albums/:albumid'     : 'album'\n        'albums/:albumid/edit': 'albumedit'\n\n    # display the \"home\" page : list of albums\n    albumslist: (editable=false)->\n        @displayView new AlbumsListView\n            collection: app.albums\n            editable: editable\n\n    # display the list of albums in edit mode\n    albumslistedit: ->\n        return @navigate 'albums', true if app.mode is 'public'\n        @albumslist true\n\n    # display the album view for an album with given id\n    # fetch before displaying it\n    album: (id, editable=false) ->\n        if @mainView?.model?.get('id') is id\n\n            if editable\n                @mainView.makeEditable()\n            else\n                @mainView.makeNonEditable()\n\n        else\n            album = app.albums.get(id)\n\n            if album?\n                @displayView new AlbumView\n                    model: album\n                    editable: editable\n            else\n                album = new Album id:id\n                album.fetch()\n                .done =>\n                    @displayView new AlbumView\n                        model: album\n                        editable: editable\n                .fail =>\n                    alert t 'this album does not exist'\n                    @navigate 'albums', true\n\n    # display the album view in edit mode\n    albumedit: (id) ->\n        return @navigate 'albums', true if app.mode is 'public'\n        @album id, true\n        setTimeout ->\n            $('#title').focus()\n        , 200\n\n    # display the album view for a new Album\n    newalbum: ->\n        return @navigate 'albums', true if app.mode is 'public'\n        window.app.albums.create {},\n            success: (model) =>\n                @navigate \"albums/#{model.id}/edit\", true\n            error: =>\n                @navigate \"albums\", true\n\n    # display a page properly (remove previous page)\n    displayView: (view) =>\n        @mainView.remove() if @mainView\n        @mainView = view\n\n        el = @mainView.render().$el\n        el.addClass \"mode-#{app.mode}\"\n        $('body').append el\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\nvar locals_ = (locals || {}),id = locals_.id,clearance = locals_.clearance,downloadPath = locals_.downloadPath,photosNumber = locals_.photosNumber,title = locals_.title,description = locals_.description;\nbuf.push(\"<div id=\\\"about\\\"><div class=\\\"clearfix\\\"><div id=\\\"links\\\" class=\\\"clearfix\\\"><p class=\\\"back\\\"><a href=\\\"#albums\\\" class=\\\"flatbtn\\\"><span class=\\\"glyphicon glyphicon-arrow-left icon-white\\\"></span><span>\" + (jade.escape(null == (jade_interp = t(\"Back\")) ? \"\" : jade_interp)) + \"</span></a></p><p class=\\\"startediting\\\"><a\" + (jade.attr(\"href\", \"#albums/\" + (id) + \"/edit\", true, false)) + \" class=\\\"flatbtn\\\"><span class=\\\"glyphicon glyphicon-edit icon-white\\\"></span><span>\" + (jade.escape(null == (jade_interp = t(\"Edit\")) ? \"\" : jade_interp)) + \"</span></a></p><p class=\\\"stopediting\\\"><a\" + (jade.attr(\"href\", \"#albums/\" + (id) + \"\", true, false)) + \" class=\\\"flatbtn\\\"><span class=\\\"glyphicon glyphicon-arrow-left icon-white\\\"></span><span>\" + (jade.escape(null == (jade_interp = t(\"Stop editing\")) ? \"\" : jade_interp)) + \"</span></a></p><P class=\\\"clearance\\\"><a class=\\\"flatbtn clearance\\\">\");\nif ( clearance == 'public')\n{\nbuf.push(\"<span class=\\\"glyphicon glyphicon-globe icon-white\\\"></span>&nbsp;\\n\" + (jade.escape((jade_interp = t('public')) == null ? '' : jade_interp)) + \"\");\n}\nelse if ( clearance && clearance.length > 0)\n{\nbuf.push(\"<span>\" + (jade.escape(null == (jade_interp = clearance.length) ? \"\" : jade_interp)) + \"</span><span class=\\\"glyphicon glyphicon-share icon-white\\\"></span>&nbsp;\\n\" + (jade.escape((jade_interp = t('shared')) == null ? '' : jade_interp)) + \"\");\n}\nelse\n{\nbuf.push(\"<span class=\\\"glyphicon glyphicon-lock icon-white\\\"></span>&nbsp;\\n\" + (jade.escape((jade_interp = t('private')) == null ? '' : jade_interp)) + \"\");\n}\nbuf.push(\"</a></P><p class=\\\"download\\\"><a\" + (jade.attr(\"href\", \"\" + (downloadPath) + \"\", true, false)) + \" class=\\\"flatbtn\\\"><span class=\\\"glyphicon glyphicon-download-alt icon-white\\\"></span><span>\" + (jade.escape(null == (jade_interp = t(\"Download\")) ? \"\" : jade_interp)) + \"</span></a></p><p class=\\\"delete\\\"><a class=\\\"flatbtn delete\\\"><span class=\\\"glyphicon glyphicon-remove icon-white\\\"></span><span>\" + (jade.escape(null == (jade_interp = t(\"Delete\")) ? \"\" : jade_interp)) + \"</span></a></p></div><div id=\\\"album-text\\\"><div id=\\\"album-text-background\\\"><div class=\\\"right\\\"><p><span class=\\\"photo-number\\\">\" + (jade.escape(null == (jade_interp = photosNumber) ? \"\" : jade_interp)) + \"</span><br/><span>\" + (jade.escape(null == (jade_interp = t(\"pictures\")) ? \"\" : jade_interp)) + \"</span></p></div><form class=\\\"left\\\"><input id=\\\"title\\\" type=\\\"text\\\" placeholder=\\\"Title...\\\"\" + (jade.attr(\"value\", title, true, false)) + \"/><textarea id=\\\"description\\\" placeholder=\\\"Description...\\\">\" + (null == (jade_interp = description) ? \"\" : jade_interp) + \"</textarea></form></div></div></div></div><div id=\\\"photos\\\" class=\\\"clearfix\\\"></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<a id=\\\"create-album-link\\\" href=\\\"#albums/new\\\" class=\\\"create\\\"><span>\" + (jade.escape(null == (jade_interp = t('Create a new album')) ? \"\" : jade_interp)) + \"</span></a><p class=\\\"help\\\">\" + (jade.escape(null == (jade_interp = t('There is no public albums.')) ? \"\" : jade_interp)) + \"</p>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\nvar locals_ = (locals || {}),id = locals_.id,thumbsrc = locals_.thumbsrc,folderid = locals_.folderid,title = locals_.title;\nbuf.push(\"<a\" + (jade.attr(\"id\", \"\" + (id) + \"\", true, false)) + (jade.attr(\"href\", \"#albums/\" + (id) + \"\", true, false)) + \"><img\" + (jade.attr(\"src\", \"\" + (thumbsrc) + \")\", true, false)) + \"/><span class=\\\"title\\\">\");\nif ( folderid == \"all\")\n{\nbuf.push(jade.escape(null == (jade_interp = title) ? \"\" : jade_interp));\n}\nelse\n{\nbuf.push(\"<b>\" + (jade.escape(null == (jade_interp = title) ? \"\" : jade_interp)) + \"</b>\");\n}\nbuf.push(\"</span></a>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\nvar locals_ = (locals || {}),dates = locals_.dates,percent = locals_.percent,photos = locals_.photos,hasPrev = locals_.hasPrev,hasNext = locals_.hasNext;\nbuf.push(\"<div class=\\\"files\\\">\");\nif ( dates.length === 0)\n{\nbuf.push(\"<p>\" + (jade.escape(null == (jade_interp = t(\"photos search\")) ? \"\" : jade_interp)) + \"</p>\");\n}\nelse if ( dates === \"No photos found\")\n{\nbuf.push(\"<p>\" + (jade.escape(null == (jade_interp = t(\"no photos found\")) ? \"\" : jade_interp)) + \"</p>\");\n}\nelse if ( dates === \"Thumb creation\")\n{\nbuf.push(\"<p>\" + (jade.escape(null == (jade_interp = t(\"thumb creation\")) ? \"\" : jade_interp)) + \"</p><p>\" + (jade.escape((jade_interp = t('progress')) == null ? '' : jade_interp)) + \": \" + (jade.escape((jade_interp = percent) == null ? '' : jade_interp)) + \"%</p>\");\n}\nelse\n{\n// iterate dates\n;(function(){\n  var $$obj = dates;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var date = $$obj[$index];\n\nbuf.push(\"<h4>\" + (jade.escape((jade_interp = t(date.split('-')[1])) == null ? '' : jade_interp)) + \" \" + (jade.escape((jade_interp = date.split('-')[0]) == null ? '' : jade_interp)) + \"</h4><br/>\");\n// iterate photos[date]\n;(function(){\n  var $$obj = photos[date];\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var photo = $$obj[$index];\n\nbuf.push(\"<img\" + (jade.attr(\"src\", \"files/thumbs/\" + (photo.id) + \".jpg\", true, false)) + (jade.attr(\"id\", \"\" + (photo.id) + \"\", true, false)) + \"/>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var photo = $$obj[$index];\n\nbuf.push(\"<img\" + (jade.attr(\"src\", \"files/thumbs/\" + (photo.id) + \".jpg\", true, false)) + (jade.attr(\"id\", \"\" + (photo.id) + \"\", true, false)) + \"/>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<br/>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var date = $$obj[$index];\n\nbuf.push(\"<h4>\" + (jade.escape((jade_interp = t(date.split('-')[1])) == null ? '' : jade_interp)) + \" \" + (jade.escape((jade_interp = date.split('-')[0]) == null ? '' : jade_interp)) + \"</h4><br/>\");\n// iterate photos[date]\n;(function(){\n  var $$obj = photos[date];\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var photo = $$obj[$index];\n\nbuf.push(\"<img\" + (jade.attr(\"src\", \"files/thumbs/\" + (photo.id) + \".jpg\", true, false)) + (jade.attr(\"id\", \"\" + (photo.id) + \"\", true, false)) + \"/>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var photo = $$obj[$index];\n\nbuf.push(\"<img\" + (jade.attr(\"src\", \"files/thumbs/\" + (photo.id) + \".jpg\", true, false)) + (jade.attr(\"id\", \"\" + (photo.id) + \"\", true, false)) + \"/>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<br/>\");\n    }\n\n  }\n}).call(this);\n\nif ( hasPrev)\n{\nbuf.push(\"<a class=\\\"btn btn-cozy left prev\\\"><p>&#12296 Prev</p></a>\");\n}\nif ( hasNext)\n{\nbuf.push(\"<a class=\\\"btn btn-cozy right next\\\"><p>Next &#12297</p></a>\");\n}\n}\nbuf.push(\"</div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<p class=\\\"help\\\">\" + (jade.escape(null == (jade_interp = t('There is no photos in this album')) ? \"\" : jade_interp)) + \"</p><div id=\\\"uploadblock\\\" class=\\\"flatbtn\\\"><input id=\\\"uploader\\\" type=\\\"file\\\" multiple=\\\"multiple\\\"/><div class=\\\"pa2\\\">\" + (jade.escape(null == (jade_interp = t('pick from computer')) ? \"\" : jade_interp)) + \"</div></div><div id=\\\"browseFiles\\\" class=\\\"flatbtn\\\"><div class=\\\"pa2\\\">\" + (jade.escape(null == (jade_interp = t('pick from files')) ? \"\" : jade_interp)) + \"</div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\nvar locals_ = (locals || {}),src = locals_.src,title = locals_.title,thumbsrc = locals_.thumbsrc;\nbuf.push(\"<a\" + (jade.attr(\"href\", \"\" + (src) + \"\", true, false)) + (jade.attr(\"title\", \"\" + (title) + \"\", true, false)) + \"><img\" + (jade.attr(\"src\", \"\" + (thumbsrc) + \"\", true, false)) + (jade.attr(\"alt\", \"\" + (title) + \"\", true, false)) + \"/><div class=\\\"progressfill\\\"></div></a><button class=\\\"delete flatbtn\\\"><i class=\\\"icon-remove icon-white\\\"></i></button>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","app = require 'application'\n\nBaseView = require 'lib/base_view'\nGalery = require 'views/galery'\nClipboard = require 'lib/clipboard'\n\nthProcessor = require 'models/thumbprocessor'\nCozyClearanceModal = require 'cozy-clearance/modal_share_view'\nclipboard = new Clipboard()\n\nTAB_KEY_CODE = 9\n\nclass ShareModal extends CozyClearanceModal\n    initialize: ->\n        super\n        @refresh()\n\n    # override makeURL to append the key in the middle of the url\n    # see: models/album:getPublicURL\n    makeURL: (key) -> @model.getPublicURL key\n\nmodule.exports = class AlbumView extends BaseView\n    template: require 'templates/album'\n\n    id: 'album'\n    className: 'container-fluid'\n\n    events: =>\n        'click a.delete': @destroyModel\n        'click a.clearance': @changeClearance\n        'click a.sendmail': @sendMail\n        'click a#rebuild-th-btn': @rebuildThumbs\n        'blur #title': @onTitleChanged\n        'blur #description': @onDescriptionChanged\n        'click #title': @onFieldClicked\n        'click #description': @onFieldClicked\n        'mousedown #title': @onFieldClicked\n        'mousedown #description': @onFieldClicked\n        'mouseup #title': @onFieldClicked\n        'mouseup #description': @onFieldClicked\n        'keydown #description': @onDescriptionKeyUp\n\n\n    initialize: (options) ->\n        super options\n\n        @listenTo @model.photos, 'add remove', @onPhotoCollectionChange\n\n    getRenderData: ->\n        key = $.url().param('key')\n        downloadPath = \"albums/#{@model.get 'id'}.zip\"\n        downloadPath += \"?key=#{key}\" if key?\n\n        res = _.extend\n            downloadPath: downloadPath\n            photosNumber: @model.photos.length\n        , @model.attributes\n        res\n\n    afterRender: ->\n        @galery = new Galery\n            el: @$ '#photos'\n            editable: @options.editable\n            collection: @model.photos\n            beforeUpload: @beforePhotoUpload\n\n        @title = @$ '#title'\n        @description = @$ '#description'\n\n        @galery.album = @model\n        @galery.render()\n\n        if @options.editable\n            @makeEditable()\n        else\n            @title.addClass 'disabled'\n            @description.addClass 'disabled'\n\n    beforePhotoUpload: (callback) =>\n        callback albumid: @model.id\n\n    onTitleChanged: =>\n        @saveModel title: @title.val().trim()\n\n    onDescriptionChanged: =>\n        @saveModel description: @description.val().trim()\n\n    makeEditable: =>\n        @$el.addClass 'editing'\n        @options.editable = true\n        @galery.options.editable = true\n\n    makeNonEditable: =>\n        @$el.removeClass 'editing'\n        @options.editable = false\n        @galery.options.editable = false\n\n    onFieldClicked: (event) =>\n        unless @options.editable\n            event.preventDefault()\n            false\n\n    # Ask for confirmation if album is not new.\n    destroyModel: ->\n        if confirm t \"are you sure you want to delete this album\"\n            @model.destroy().then ->\n                app.router.navigate 'albums', true\n\n    # Change sharing state of the album.\n    changeClearance: (event) =>\n        @model.set 'clearance', [] unless @model.get('clearance')?\n        @model.set 'type', 'album'\n        new ShareModal model: @model\n\n    # Temporary tool to allow people to rebuild the thumbnails with size\n    # set recently. New size is larger, so older thumbs looks blurry.\n    # This function recalculate them with the right size\n    rebuildThumbs: (event) ->\n        $(\"#rebuild-th p\").remove()\n        models = @model.photos.models\n\n        recFunc = ->\n            if models.length > -1\n                model = models.pop()\n                setTimeout ->\n                    thProcessor.process model\n                    recFunc()\n                , 500\n        recFunc()\n\n    onDescriptionKeyUp: (event) ->\n        if TAB_KEY_CODE in [event.keyCode, event.which]\n            $('.stopediting').focus()\n\n    saveModel: (data) ->\n        @model.save data\n\n    onPhotoCollectionChange: ->\n        # updates the photo counter\n        @$('.photo-number').html @model.photos.length\n","ViewCollection = require 'lib/view_collection'\napp = require 'application'\n\n# \"Home\" view : the list of album\n# simple ViewCollection\n# pass editable options to children\n\nmodule.exports = class AlbumsList extends ViewCollection\n    id: 'album-list'\n    itemView: require 'views/albumslist_item'\n    template: require 'templates/albumlist'\n\n    initialize: ->\n        super\n\n    checkIfEmpty: =>\n        @$('.help').toggle _.size(@views) is 0 and app.mode is 'public'\n\n    afterRender: ->\n        super\n","BaseView = require 'lib/base_view'\n{limitLength} = require 'lib/helpers'\nhelpers = require 'lib/helpers'\n\n# Item View for the albums list\nmodule.exports = class AlbumItem extends BaseView\n    className: 'albumitem'\n    template: require 'templates/albumlist_item'\n\n    initialize: ->\n        @listenTo @model, 'change', => @render()\n\n    getRenderData: ->\n        out = _.clone @model.attributes\n        out.description = limitLength out.description, 250\n        out.thumbsrc =  @model.getThumbSrc()\n        return out\n\n    afterRender: ->\n        @image = @$ 'img'\n        @image.attr 'src', @model.getThumbSrc()\n        helpers.rotate @model.attributes.orientation, @image\n","Modal = require 'cozy-clearance/modal'\nPhoto = require '../models/photo'\n\n\nmodule.exports = class FilesBrowser extends Modal\n\n    id: 'files-browser-modal'\n    template_content: require '../templates/browser'\n    title: t 'pick from files'\n    content: '<p>Loading ...</p>'\n\n    events: -> _.extend super,\n        'click img': 'toggleSelected'\n        'click a.next': 'displayNextPage'\n        'click a.prev': 'displayPrevPage'\n\n    toggleSelected: (e) ->\n        $(e.target).toggleClass 'selected'\n\n    getRenderData: -> @options\n\n    initialize: (options) ->\n        # Prepare option\n        if not options.page?\n            super {}\n        if not options.page?\n            options.page = 0\n        if not options.selected?\n            @options.selected = []\n        @options.page = options.page\n\n        # Recover files\n        Photo.listFromFiles options.page, (err, body) =>\n            dates = body.files if body?.files?\n\n            if err\n                return console.log err\n\n            # If server create thumb : doesn't display files.\n            else if body.percent?\n                @options.dates = \"Thumb creation\"\n                @options.percent = body.percent\n                pathToSocketIO = \\\n                    \"#{window.location.pathname.substring(1)}socket.io\"\n                socket = io.connect window.location.origin,\n                    resource: pathToSocketIO\n                socket.on 'progress', (event) =>\n                    @options.percent = event.percent\n                    if @options.percent is 100\n                        @initialize options\n                    else\n                        template = @template_content @getRenderData()\n                        @$('.modal-body').html template\n\n            # If there is no photos in Cozy\n            else if dates? and Object.keys(dates).length is 0\n                @options.dates = \"No photos found\"\n\n            else\n                # Add next/prev button\n                @options.hasNext = body.hasNext if body?.hasNext?\n                @options.hasPrev = options.page isnt 0\n                @options.dates = Object.keys(dates)\n                @options.dates.sort (a, b) ->\n                    -1 * a.localeCompare b\n                @options.photos = dates\n\n            @$('.modal-body').html @template_content @getRenderData()\n            @$('.modal-body').scrollTop(0)\n            # Add selected files\n            if @options.selected[@options.page]?\n                for img in @options.selected[@options.page]\n                    @$(\"##{img.id}\").toggleClass 'selected'\n\n    cb: (confirmed) ->\n        return unless confirmed\n        @options.beforeUpload (attrs) =>\n            tmp = []\n            @options.selected[@options.page] = @$('.selected')\n            for page in @options.selected\n                for img in page\n                    fileid = img.id\n\n                    # Create a temporary photo\n                    attrs.title = img.name\n                    phototmp = new Photo attrs\n                    phototmp.file = img\n                    tmp.push phototmp\n                    @collection.add phototmp\n\n                    Photo.makeFromFile fileid, attrs, (err, photo) =>\n                        return console.log err if err\n                        # Replace temporary photo\n                        phototmp = tmp.pop()\n                        @collection.remove phototmp, parse: true\n                        @collection.add photo, parse: true\n\n    displayNextPage: ->\n        # Display next page: store selected files\n        @options.selected[@options.page] = @$('.selected')\n        options =\n            page: @options.page + 1\n            selected: @options.selected\n        @initialize options\n\n    displayPrevPage: ->\n        # Display prev page: store selected files\n        @options.selected[@options.page] = @$('.selected')\n        options =\n            page: @options.page - 1\n            selected: @options.selected\n        @initialize options\n\n","ViewCollection = require 'lib/view_collection'\nhelpers = require 'lib/helpers'\nFilesBrowser = require './browser'\nPhotoView = require 'views/photo'\nPhoto = require 'models/photo'\nphotoprocessor = require 'models/photoprocessor'\napp = require 'application'\n\n# galery : collection of PhotoViews\nmodule.exports = class Galery extends ViewCollection\n    itemView: PhotoView\n\n    template: require 'templates/galery'\n\n    initialize: ->\n        super\n        # when the cover picture is deleted, we remove it from the album\n        @listenTo @collection, 'destroy', @onPictureDestroyed\n\n    # launch photobox after render\n    afterRender: ->\n        super\n        @$el.photobox 'a.server',\n            thumbs: true\n            history: false\n            beforeShow: @beforeImageDisplayed\n        , @onImageDisplayed\n\n        # Addition to photobox ui to give more control to the user.\n\n        # Add button to return photo to left\n        if $('#pbOverlay .pbCaptionText .btn-group').length is 0\n            $('#pbOverlay .pbCaptionText')\n                .append('<div class=\"btn-group\"></div>')\n        @turnLeft = $('#pbOverlay .pbCaptionText .btn-group .left')\n        @turnLeft.unbind 'click'\n        @turnLeft.remove()\n        if navigator.userAgent.search(\"Firefox\") isnt -1\n            transform = \"transform\"\n        else\n            transform = \"-webkit-transform\"\n        @turnLeft = $('<a id=\"left\" class=\"btn left\" type=\"button\">\n                       <i class=\"glyphicon glyphicon-share-alt glyphicon-reverted\"\n                        style=\"' + transform + ': scale(-1,1)\"> </i> </a>')\n            .appendTo '#pbOverlay .pbCaptionText .btn-group'\n        @turnLeft.on 'click', @onTurnLeft\n\n        # Add link to download photo\n        @downloadLink = $('#pbOverlay .pbCaptionText  .btn-group .download-link')\n        @downloadLink.unbind 'click'\n        @downloadLink.remove()\n        unless @downloadLink.length\n            @downloadLink =\n                $('<a class=\"btn download-link\" download>\n                  <i class=\"glyphicon glyphicon-arrow-down\"></i></a>')\n                .appendTo '#pbOverlay .pbCaptionText .btn-group'\n\n        @uploader = @$('#uploader')\n\n        # Cover button to select cover\n        @coverBtn = $('#pbOverlay .pbCaptionText .btn-group .cover-btn')\n        @coverBtn.unbind 'click'\n        @coverBtn.remove()\n        @coverBtn = $('<a id=\"cover-btn\" class=\"btn cover-btn\">\n                       <i class=\"glyphicon glyphicon-picture\" </i> </a>')\n            .appendTo '#pbOverlay .pbCaptionText .btn-group'\n        @coverBtn.on 'click', @onCoverClicked\n\n        # Add button to return photo to right\n        @turnRight = $('#pbOverlay .pbCaptionText .btn-group .right')\n        @turnRight.unbind 'click'\n        @turnRight.remove()\n        @turnRight = $('<a id=\"right\" class=\"btn right\">\n                       <i class=\"glyphicon glyphicon-share-alt\" </i> </a>')\n            .appendTo '#pbOverlay .pbCaptionText .btn-group'\n        @turnRight.on 'click', @onTurnRight\n\n        for key, view of @views\n            view.collection = @collection\n\n    checkIfEmpty: =>\n        @$('.help').toggle _.size(@views) is 0 and app.mode is 'public'\n\n    # D&D events\n    events: ->\n        'drop'     : 'onFilesDropped'\n        'dragover' : 'onDragOver'\n        'dragleave' : 'onDragLeave'\n        'change #uploader': 'onFilesChanged'\n        'click #browseFiles': 'displayBrowser'\n\n    # event listeners for D&D events\n    onFilesDropped: (evt) ->\n        if @options.editable\n            @$el.removeClass 'dragover'\n            @handleFiles evt.dataTransfer.files\n            evt.stopPropagation()\n            evt.preventDefault()\n        return false\n\n    # Display orange background telling that drag is active.\n    onDragOver: (evt) ->\n        if @options.editable\n            @$el.addClass 'dragover'\n            evt.preventDefault()\n            evt.stopPropagation()\n        return false\n\n    onDragLeave: (evt) ->\n        if @options.editable\n            @$el.removeClass 'dragover'\n            evt.preventDefault()\n            evt.stopPropagation()\n        return false\n\n    # Extract photo id from its URL. It's useful to get the id of the current\n    # picture when the user browses them via photobox.\n    getIdPhoto: (url) =>\n        url ?= $('#pbOverlay .wrapper img.zoomable').attr 'src'\n        parts = url.split('/')\n        id = parts[parts.length - 1]\n        id = id.split('.')[0]\n        return id\n\n    # Rotate 90° left the picture by updating css and orientation.\n    onTurnLeft: () =>\n        id = @getIdPhoto()\n        orientation = @collection.get(id)?.attributes.orientation\n        newOrientation =\n            helpers.rotateLeft orientation, $('.wrapper img.zoomable')\n        helpers.rotate newOrientation, $('.wrapper img.zoomable')\n        @collection.get(id)?.save orientation: newOrientation,\n            success : () =>\n                helpers.rotate newOrientation, $('.pbThumbs .active img')\n\n    # Rotate 90° right the picture by updating css and orientation.\n    onTurnRight: () =>\n        id = @getIdPhoto()\n        orientation = @collection.get(id)?.attributes.orientation\n        newOrientation =\n            helpers.rotateRight orientation, $('.wrapper img.zoomable')\n        helpers.rotate newOrientation, $('.wrapper img.zoomable')\n        @collection.get(id)?.save orientation: newOrientation,\n            success : () =>\n                helpers.rotate newOrientation, $('.pbThumbs .active img')\n\n    # When cover button is clicked, the current picture is set on the current\n    # album as cover. Then information are saved.\n    onCoverClicked: () =>\n        @coverBtn.addClass 'disabled'\n        photoId = @getIdPhoto()\n        @album.set 'coverPicture', photoId\n        @album.set 'thumb', photoId\n        @album.set 'thumbsrc', @album.getThumbSrc()\n        @album.save null,\n            success: =>\n                @coverBtn.removeClass 'disabled'\n                alert t 'photo successfully set as cover'\n            error: =>\n                @coverBtn.removeClass 'disabled'\n                alert t 'problem occured while setting cover'\n\n    onPictureDestroyed: (destroyed) =>\n        if destroyed.id is @album.get 'coverPicture'\n            @album.save coverPicture: null\n\n    onFilesChanged: (evt) =>\n        @handleFiles @uploader[0].files\n        # reset the iNput\n        old = @uploader\n        @uploader = old.clone true\n        old.replaceWith @uploader\n\n    beforeImageDisplayed: (link) =>\n        id = @getIdPhoto link.href\n        orientation = @collection.get(id)?.attributes.orientation\n        $('#pbOverlay .wrapper img')[0].dataset.orientation = orientation\n\n    onImageDisplayed: (args) =>\n        # Initialize download link\n        url = $('.pbThumbs .active img').attr 'src'\n        id = @getIdPhoto()\n        @downloadLink.attr 'href', url.replace 'thumbs', 'raws'\n\n        # Rotate thumbs\n        thumbs = $('#pbOverlay .pbThumbs img')\n        for thumb in thumbs\n            url = thumb.src\n            parts = url.split('/')\n            id = parts[parts.length - 1]\n            id = id.split('.')[0]\n            orientation = @collection.get(id)?.attributes.orientation\n            helpers.rotate orientation, $(thumb)\n\n    handleFiles: (files) ->\n        # allow parent view to set some attributes on the photo\n        # (current usage = albumid + save album if it is new)\n        @options.beforeUpload (photoAttributes) =>\n\n            for file in files\n                photoAttributes.title = file.name\n                photo = new Photo photoAttributes\n                photo.file = file\n                @collection.add photo\n                photoprocessor.process photo\n\n            for key, view of @views\n                view.collection = @collection\n\n            photo.on 'uploadComplete', =>\n                unless @album.get('coverPicture')?\n                    @album.save coverPicture: photo.get 'id'\n\n    displayBrowser: ->\n        new FilesBrowser\n            model: @album\n            collection: @collection\n            beforeUpload: @options.beforeUpload\n","BaseView = require 'lib/base_view'\nhelpers = require 'lib/helpers'\n\ntransitionendEvents = [\n    \"transitionend\", \"webkitTransitionEnd\", \"oTransitionEnd\", \"MSTransitionEnd\"\n].join(\" \")\n\n# View for a single photo\n# Expected options {model, editable}\nmodule.exports = class PhotoView extends BaseView\n    template: require 'templates/photo'\n    className: 'photo'\n\n    initialize: (options) ->\n        super\n        @listenTo @model, 'progress',        @onProgress\n        @listenTo @model, 'thumbed',         @onThumbed\n        @listenTo @model, 'upError',         @onError\n        @listenTo @model, 'uploadComplete',  @onServer\n        @listenTo @model, 'change',          => @render()\n\n    events: =>\n        'click' : 'onClickListener'\n        'click .delete' : 'destroyModel'\n\n    getRenderData: -> @model.attributes\n\n    afterRender: ->\n        @link =        @$ 'a'\n        @image =       @$ 'img'\n        @progressbar = @$ '.progressfill'\n        helpers.rotate @model.get('orientation'), @image\n        @link.addClass 'server' unless @model.isNew()\n\n    setProgress: (percent) ->\n        @progressbar.css 'width', percent + '%'\n\n    # when the upload progresses\n    onProgress: (event) ->\n        @setProgress 10 + 90 * event.loaded / event.total\n\n    # when the thumb is ready, it is displayed.\n    onThumbed: ->\n        @setProgress 10\n        @image.attr 'src', @model.thumb_du\n        @image.attr 'orientation', @model.get('orientation')\n        @image.addClass 'thumbed'\n\n    # when the upload is complete, the view of the photo is refreshed via a\n    # remove/add.\n    onServer: ->\n        # detach-reatach so photobox can pick up the object\n        preload = new Image()\n        preload.onerror = preload.onload = =>\n            @render()\n\n        preload.src = \"photos/thumbs/#{@model.id}.jpg\"\n\n    # when an error occured, the photo is marked with error image.\n    onError: (err) ->\n        @setProgress 0\n        @error = @model.get('title') + \" \" + err\n        @link.attr 'title', @error\n        @image.attr 'src', 'img/error.gif'\n\n    # Prevent opeNing the gallery if the photos\n    # hasn't been upload yet\n    onClickListener: (evt) =>\n        if @model.isNew()\n            alert @error if @error\n            evt.stopPropagation()\n            evt.preventDefault()\n            return false\n\n    destroyModel: ->\n        @$('.delete').html '&nbsp;&nbsp;&nbsp;&nbsp;'\n        @$('.delete').spin 'small'\n        @$el.fadeOut =>\n            @model.destroy\n                success: =>\n                    @collection.remove @model\n                    @remove()\n"]}